<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>기초-인증과 권한 | Knowledge Share</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.3cf712f1.css" as="style"><link rel="preload" href="/assets/js/app.226a413b.js" as="script"><link rel="preload" href="/assets/js/2.73abacf5.js" as="script"><link rel="preload" href="/assets/js/78.38e4043b.js" as="script"><link rel="prefetch" href="/assets/js/10.351a57cb.js"><link rel="prefetch" href="/assets/js/11.6393c270.js"><link rel="prefetch" href="/assets/js/12.258ce84f.js"><link rel="prefetch" href="/assets/js/13.0e799513.js"><link rel="prefetch" href="/assets/js/14.1bed9505.js"><link rel="prefetch" href="/assets/js/15.d3ebe5dd.js"><link rel="prefetch" href="/assets/js/16.f2f87609.js"><link rel="prefetch" href="/assets/js/17.bbd8a445.js"><link rel="prefetch" href="/assets/js/18.7d163443.js"><link rel="prefetch" href="/assets/js/19.19b5b7f6.js"><link rel="prefetch" href="/assets/js/20.829e3d87.js"><link rel="prefetch" href="/assets/js/21.bc454723.js"><link rel="prefetch" href="/assets/js/22.5c67cf08.js"><link rel="prefetch" href="/assets/js/23.3dec653b.js"><link rel="prefetch" href="/assets/js/24.01bbc434.js"><link rel="prefetch" href="/assets/js/25.4f4cd96f.js"><link rel="prefetch" href="/assets/js/26.3d026ee4.js"><link rel="prefetch" href="/assets/js/27.4c1a5062.js"><link rel="prefetch" href="/assets/js/28.b34493f3.js"><link rel="prefetch" href="/assets/js/29.4370a6f6.js"><link rel="prefetch" href="/assets/js/3.0119ca6e.js"><link rel="prefetch" href="/assets/js/30.9b3ad4ec.js"><link rel="prefetch" href="/assets/js/31.eb5641ed.js"><link rel="prefetch" href="/assets/js/32.eaa85e4f.js"><link rel="prefetch" href="/assets/js/33.f93228ab.js"><link rel="prefetch" href="/assets/js/34.482bd009.js"><link rel="prefetch" href="/assets/js/35.77e80232.js"><link rel="prefetch" href="/assets/js/36.6154cdc8.js"><link rel="prefetch" href="/assets/js/37.ad4220f1.js"><link rel="prefetch" href="/assets/js/38.db259bfc.js"><link rel="prefetch" href="/assets/js/39.31066864.js"><link rel="prefetch" href="/assets/js/4.18b7f171.js"><link rel="prefetch" href="/assets/js/40.2f92ff2c.js"><link rel="prefetch" href="/assets/js/41.434423f6.js"><link rel="prefetch" href="/assets/js/42.b226d007.js"><link rel="prefetch" href="/assets/js/43.4022eb0b.js"><link rel="prefetch" href="/assets/js/44.24df495c.js"><link rel="prefetch" href="/assets/js/45.934df6e3.js"><link rel="prefetch" href="/assets/js/46.3c84a5bb.js"><link rel="prefetch" href="/assets/js/47.fe62c0b5.js"><link rel="prefetch" href="/assets/js/48.8e1b28b6.js"><link rel="prefetch" href="/assets/js/49.56580a1b.js"><link rel="prefetch" href="/assets/js/5.96509959.js"><link rel="prefetch" href="/assets/js/50.5a76b24b.js"><link rel="prefetch" href="/assets/js/51.15eefc48.js"><link rel="prefetch" href="/assets/js/52.288a7c9a.js"><link rel="prefetch" href="/assets/js/53.0344e8e6.js"><link rel="prefetch" href="/assets/js/54.051230fc.js"><link rel="prefetch" href="/assets/js/55.0d6d875f.js"><link rel="prefetch" href="/assets/js/56.cb2d6ed4.js"><link rel="prefetch" href="/assets/js/57.e46f3cc2.js"><link rel="prefetch" href="/assets/js/58.a1265c97.js"><link rel="prefetch" href="/assets/js/59.e43d9167.js"><link rel="prefetch" href="/assets/js/6.eafd2c6f.js"><link rel="prefetch" href="/assets/js/60.f6b21a78.js"><link rel="prefetch" href="/assets/js/61.4a860e23.js"><link rel="prefetch" href="/assets/js/62.6ce4d451.js"><link rel="prefetch" href="/assets/js/63.39c70403.js"><link rel="prefetch" href="/assets/js/64.01d48950.js"><link rel="prefetch" href="/assets/js/65.eff11926.js"><link rel="prefetch" href="/assets/js/66.5f7ada7a.js"><link rel="prefetch" href="/assets/js/67.038d3536.js"><link rel="prefetch" href="/assets/js/68.51d474f1.js"><link rel="prefetch" href="/assets/js/69.7b64006b.js"><link rel="prefetch" href="/assets/js/7.9345f576.js"><link rel="prefetch" href="/assets/js/70.026d7c8c.js"><link rel="prefetch" href="/assets/js/71.23fea48d.js"><link rel="prefetch" href="/assets/js/72.66e45e3c.js"><link rel="prefetch" href="/assets/js/73.fd7cba88.js"><link rel="prefetch" href="/assets/js/74.2b525f65.js"><link rel="prefetch" href="/assets/js/75.fa84901e.js"><link rel="prefetch" href="/assets/js/76.a8d34081.js"><link rel="prefetch" href="/assets/js/77.3cc197c2.js"><link rel="prefetch" href="/assets/js/79.0233dc04.js"><link rel="prefetch" href="/assets/js/8.c76ec235.js"><link rel="prefetch" href="/assets/js/80.37f9db76.js"><link rel="prefetch" href="/assets/js/81.739c140e.js"><link rel="prefetch" href="/assets/js/82.db22bc06.js"><link rel="prefetch" href="/assets/js/83.e0a3b10f.js"><link rel="prefetch" href="/assets/js/84.165fae16.js"><link rel="prefetch" href="/assets/js/85.deea94b4.js"><link rel="prefetch" href="/assets/js/86.f08273d4.js"><link rel="prefetch" href="/assets/js/87.693b40b0.js"><link rel="prefetch" href="/assets/js/88.4610ab9a.js"><link rel="prefetch" href="/assets/js/89.534d2db6.js"><link rel="prefetch" href="/assets/js/9.f853c54c.js"><link rel="prefetch" href="/assets/js/90.975fdff4.js"><link rel="prefetch" href="/assets/js/91.18312f77.js"><link rel="prefetch" href="/assets/js/92.79d88ce2.js"><link rel="prefetch" href="/assets/js/93.d66f6efe.js"><link rel="prefetch" href="/assets/js/94.3e4c63cd.js"><link rel="prefetch" href="/assets/js/95.95b09757.js"><link rel="prefetch" href="/assets/js/96.588d599f.js"><link rel="prefetch" href="/assets/js/97.21b640fd.js"><link rel="prefetch" href="/assets/js/98.bd06af5f.js"><link rel="prefetch" href="/assets/js/99.8d1cc7e9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3cf712f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Knowledge Share</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frameworks/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/vuejs/" class="nav-link">
  VueJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/django/" class="nav-link">
  Django
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nuxtjs/" class="nav-link">
  NuxtJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nestjs/" class="nav-link">
  NestJS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool &amp; Module" class="dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tool &amp; Module" class="mobile-dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool-module/django-rest/" class="nav-link router-link-active">
  Django-REST
</a></li><li class="dropdown-item"><!----> <a href="/tool-module/clean-arch/" class="nav-link">
  Clean Architecture
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Workflow" class="dropdown-title"><span class="title">Workflow</span> <span class="arrow down"></span></button> <button type="button" aria-label="Workflow" class="mobile-dropdown-title"><span class="title">Workflow</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workflow/nuxtjs-django/" class="nav-link">
  NuxtJS-Django
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frameworks/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/vuejs/" class="nav-link">
  VueJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/django/" class="nav-link">
  Django
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nuxtjs/" class="nav-link">
  NuxtJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nestjs/" class="nav-link">
  NestJS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool &amp; Module" class="dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tool &amp; Module" class="mobile-dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool-module/django-rest/" class="nav-link router-link-active">
  Django-REST
</a></li><li class="dropdown-item"><!----> <a href="/tool-module/clean-arch/" class="nav-link">
  Clean Architecture
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Workflow" class="dropdown-title"><span class="title">Workflow</span> <span class="arrow down"></span></button> <button type="button" aria-label="Workflow" class="mobile-dropdown-title"><span class="title">Workflow</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workflow/nuxtjs-django/" class="nav-link">
  NuxtJS-Django
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Django REST</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool-module/django-rest/" aria-current="page" class="sidebar-link">Why Django REST?</a></li><li><a href="/tool-module/django-rest/tutorial-1-serialization.html" class="sidebar-link">기초-직렬화</a></li><li><a href="/tool-module/django-rest/tutorial-2-request.html" class="sidebar-link">기초-요청과 응답</a></li><li><a href="/tool-module/django-rest/tutorial-3-classbase.html" class="sidebar-link">기초-Class View</a></li><li><a href="/tool-module/django-rest/tutorial-4-authentication.html" aria-current="page" class="active sidebar-link">기초-인증과 권한</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#모델에-정보-추가" class="sidebar-link">모델에 정보 추가</a></li><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#사용자-모델에-대한-엔드-포인트-추가" class="sidebar-link">사용자 모델에 대한 엔드 포인트 추가</a></li><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#스니펫을-사용자에-연결" class="sidebar-link">스니펫을 사용자에 연결</a></li><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#serializer의-업데이트" class="sidebar-link">serializer의 업데이트</a></li><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#뷰에-필요한-권한-추가" class="sidebar-link">뷰에 필요한 권한 추가</a></li><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#browsable-api에-로그인-추가" class="sidebar-link">browsable API에 로그인 추가</a></li><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#객체-수준-권한" class="sidebar-link">객체 수준 권한</a></li><li class="sidebar-sub-header"><a href="/tool-module/django-rest/tutorial-4-authentication.html#api로-인증" class="sidebar-link">API로 인증</a></li></ul></li><li><a href="/tool-module/django-rest/tutorial-5-relationship.html" class="sidebar-link">기초-관계 &amp; 하이퍼링크</a></li><li><a href="/tool-module/django-rest/tutorial-6-viewsets.html" class="sidebar-link">기초-뷰셋 &amp; 라우터</a></li><li><a href="/tool-module/django-rest/generic-view.html" class="sidebar-link">심화-Generic Views</a></li><li><a href="/tool-module/django-rest/viewsets.html" class="sidebar-link">심화-ViewSets</a></li><li><a href="/tool-module/django-rest/serializer.html" class="sidebar-link">심화-Serializers</a></li><li><a href="/tool-module/django-rest/serializer-relations.html" class="sidebar-link">심화-Serializer Relations</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="기초-인증과-권한"><a href="#기초-인증과-권한" class="header-anchor">#</a> 기초-인증과 권한</h1> <p>현재 API에는 코드 스니펫을 편집하거나 삭제할 수있는 사람에 대한 제한이 없습니다. 다음과 같이 작동하기 원합니다.</p> <ul><li>코드 스니펫은 항상 제작자와 연결되어 있습니다.</li> <li>인증된 사용자만 스니펫을 만들 수 있습니다.</li> <li>스니펫을 만든 사람만 업데이트 하거나 삭제할 수 있습니다.</li> <li>인증되지 않은 요청에 전체 읽기 전용 권한이 있어야 합니다.</li></ul> <h2 id="모델에-정보-추가"><a href="#모델에-정보-추가" class="header-anchor">#</a> 모델에 정보 추가</h2> <p>Snippet 모델 클래스에 필드를 추가하겠습니다. 이러한 필드 중 하나는 코드 스니펫을 만든 사용자를 나타내는 데 사용됩니다. 다른 필드는 highlight 코드의 HTML 표현을 저장하는 데 사용됩니다.</p> <p><code>models.py</code>의 Snippet 모델에 다음 두 필드를 추가하십시오.</p> <div class="language-python extra-class"><pre class="language-python"><code>owner <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">'auth.User'</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'snippets'</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
highlighted <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>또한 모델이 저장 될 때 pygments 코드 highlight 라이브러리를 사용하여 강조 표시된 필드를 채우도록 해야합니다.:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pygments<span class="token punctuation">.</span>lexers <span class="token keyword">import</span> get_lexer_by_name
<span class="token keyword">from</span> pygments<span class="token punctuation">.</span>formatters<span class="token punctuation">.</span>html <span class="token keyword">import</span> HtmlFormatter
<span class="token keyword">from</span> pygments <span class="token keyword">import</span> highlight
</code></pre></div><p>이제 모델 클래스에 <code>.save()</code>메소드를 추가합니다 :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Use the `pygments` library to create a highlighted HTML
    representation of the code snippet.
    &quot;&quot;&quot;</span>
    lexer <span class="token operator">=</span> get_lexer_by_name<span class="token punctuation">(</span>self<span class="token punctuation">.</span>language<span class="token punctuation">)</span>
    linenos <span class="token operator">=</span> <span class="token string">'table'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>linenos <span class="token keyword">else</span> <span class="token boolean">False</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>title<span class="token punctuation">}</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>title <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    formatter <span class="token operator">=</span> HtmlFormatter<span class="token punctuation">(</span>style<span class="token operator">=</span>self<span class="token punctuation">.</span>style<span class="token punctuation">,</span> linenos<span class="token operator">=</span>linenos<span class="token punctuation">,</span>
                              full<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>options<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>highlighted <span class="token operator">=</span> highlight<span class="token punctuation">(</span>self<span class="token punctuation">.</span>code<span class="token punctuation">,</span> lexer<span class="token punctuation">,</span> formatter<span class="token punctuation">)</span>
    <span class="token builtin">super</span><span class="token punctuation">(</span>Snippet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre></div><p>Model이 변경되면 데이터베이스 테이블을 업데이트 해야합니다. 일반적으로 이를 수행하기 위해 데이터베이스 마이그레이션을 작성하지만 이 학습서의 목적을 위해 데이터베이스를 삭제하고 다시 시작하겠습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>rm <span class="token operator">-</span>f db<span class="token punctuation">.</span>sqlite3
rm <span class="token operator">-</span>r snippets<span class="token operator">/</span>migrations
python manage<span class="token punctuation">.</span>py makemigrations snippets
python manage<span class="token punctuation">.</span>py migrate
</code></pre></div><p><code>createsuperuser</code> 명령을 사용하여 API 테스트에 사용할 다른 사용자를 빠르게 만들 수도 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>python manage<span class="token punctuation">.</span>py createsuperuser
</code></pre></div><h2 id="사용자-모델에-대한-엔드-포인트-추가"><a href="#사용자-모델에-대한-엔드-포인트-추가" class="header-anchor">#</a> 사용자 모델에 대한 엔드 포인트 추가</h2> <p>사용자 API에 추가 하겠습니다. 다음과 같이 <code>serializers.py</code> 에 새로운 UserSerializer 를 추가합니다. :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    snippets <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> queryset<span class="token operator">=</span>Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'snippets'</span><span class="token punctuation">]</span>
</code></pre></div><p>사용자 모델에서 'snippets'의 relationship 은 역순이므로 ModelSerializer 클래스를 사용할 때는 기본적으로 포함되지 않기 때문에 명시적으로 필드를 추가했습니다.</p> <p>views.py 에 몇 가지 view를 추가 할 것 입니다. user의 표현을 위해서는 읽기 전용에 제네릭 클래스 기반의 ListAPIView 및 RetrieveAPIView  뷰를 만듭니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User


<span class="token keyword">class</span> <span class="token class-name">UserList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer


<span class="token keyword">class</span> <span class="token class-name">UserDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
</code></pre></div><p>UserSerializer 클래스도 import 합니다</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> UserSerializer
</code></pre></div><p>마지막으로 URL conf 에서 참조하기 위해 해당 뷰를 API에 추가 해야합니다. snippets/urls.py 의 패턴에 다음을 추가 하겠습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>path<span class="token punctuation">(</span><span class="token string">'users/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
path<span class="token punctuation">(</span><span class="token string">'users/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="스니펫을-사용자에-연결"><a href="#스니펫을-사용자에-연결" class="header-anchor">#</a> 스니펫을 사용자에 연결</h2> <p>지금 코드 스니펫을 만드는 경우 스니펫을 만든 사용자를 스니펫 인스턴스와 연결할 방법이 없습니다. 사용자는 직렬화된 표현의 일부로 전송되지 않지만 들어오는 request의 속성이기는 합니다.</p> <p>.perform_create() 메소드는 오버라이딩하여 스니펫 view에서 인스턴스가 저장되는 관리 방식을 수정하여 들어오는 요청(request) 또는 요청 된 URL에 포함된 정보를 처리할 수 ​​있도록 하는 것입니다.</p> <p>SnippetList 뷰 클래스에 다음과 같은 메소드를 추가합니다.:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>owner<span class="token operator">=</span>self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
</code></pre></div><p>serializer의 create() 메소드는 이제 request의 검증된 데이터(validated_date)와 함께 'owner' 추가 필드를 전달 받습니다.</p> <h2 id="serializer의-업데이트"><a href="#serializer의-업데이트" class="header-anchor">#</a> serializer의 업데이트</h2> <p>스니펫이 생성한 사용자와 연결되었으므로 이를 SnippetSerializer 반영하도록 수정 하겠습니다. 다음 필드를 serializer 정의에 추가 하겠습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>owner <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ReadOnlyField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">'owner.username'</span><span class="token punctuation">)</span>
</code></pre></div><p>참고 : 'owner'를 내부 Meta클래스의 필드 목록에도 추가 해야합니다 .</p> <p>source는 속성 필드를 채우는 데 사용되며, 직렬화 된 인스턴스의 모든 속성에 가리킬 수 있습니다. 위에 표시된 점 표기법을 사용할 수도 있습니다.</p> <p>위에서 추가한 필드 ReadOnlyField 는 CharField, BooleanField 달리, 클래스 유형이 지정되지 않습니다. ReadOnlyField 는 항상 읽기 전용으로 직렬화 표현을 위해 사용되며 모델을 업데이트 하기 위해 사용되지 않습니다.</p> <h2 id="뷰에-필요한-권한-추가"><a href="#뷰에-필요한-권한-추가" class="header-anchor">#</a> 뷰에 필요한 권한 추가</h2> <p>이제 코드 스니펫이 사용자와 연결 되었으므로 인증된 사용자만 코드 스 니펫을 작성, 업데이트 및 삭제할 수 있도록 해야합니다.</p> <p>REST 프레임워크에는 지정된 뷰에 액세스 할 수있는 사람을 제한하는 데 사용할 수있는 여러 권한 클래스가 포함되어 있습니다. 이 경우 IsAuthenticatedOrReadOnly 은 인증된 요청에서 읽기-쓰기 액세스를 하고 인증되지 않은 요청은 읽기 전용 액세스를 갖도록 하는 것입니다.</p> <p>먼저 views 모듈에 다음을 import를 추가하십시오.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions
</code></pre></div><p>SnippetList 와 SnippetDetail 뷰 클래스 모두에 다음을 추가합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">]</span>
</code></pre></div><h2 id="browsable-api에-로그인-추가"><a href="#browsable-api에-로그인-추가" class="header-anchor">#</a> browsable API에 로그인 추가</h2> <p>브라우저를 열고 현재 browsable API로 이동하면 더 이상 새 코드 스니펫을 만들 수 없습니다. 그렇게 하려면 사용자로 로그인 할 수 있어야 합니다.</p> <p>프로젝트 수준 <code>urls.py</code>파일에서 URLconf를 편집하여 browsable API와 함께 사용할 로그인 view를 추가할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> include
</code></pre></div><p>또한 파일 끝에 browsable API에 대한 로그인 및 로그 아웃을 포함할 패턴을 추가하십시오.</p> <div class="language-python extra-class"><pre class="language-python"><code>urlpatterns <span class="token operator">+=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'api-auth/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'rest_framework.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><p>이제 브라우저를 다시 열고 페이지를 새로 고치면 페이지 오른쪽 상단에 '로그인' 링크가 표시됩니다. 앞에서 만든 사용자 중 하나로 로그인하면 코드 스니펫을 다시 만들 수 있습니다.</p> <p>코드 스니펫을 몇 개 만든 후에는 '/ users /'엔드 포인트로 이동 한 다음 각 사용자의 '스니펫'필드에서 각 사용자와 관련된 스니펫 ID 목록이 표시에 있는지 확인하십시오.</p> <h2 id="객체-수준-권한"><a href="#객체-수준-권한" class="header-anchor">#</a> 객체 수준 권한</h2> <p>실제로 모든 코드 스니펫을 누구나 볼 수 있기를 원하지만 코드 스니펫을 만든 사용자만 해당 코드 스니펫을 업데이트하거나 삭제할 수 있어야 합니다.</p> <p>그러기 위해서는 사용자 지정 권한을 만들어야 합니다.</p> <p>스니펫 앱에서 permissions.py 파일을 만들고</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions


<span class="token keyword">class</span> <span class="token class-name">IsOwnerOrReadOnly</span><span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Custom permission to only allow owners of an object to edit it.
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Read permissions are allowed to any request,</span>
        <span class="token comment"># so we'll always allow GET, HEAD or OPTIONS requests.</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token keyword">in</span> permissions<span class="token punctuation">.</span>SAFE_METHODS<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>

        <span class="token comment"># Write permissions are only allowed to the owner of the snippet.</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">.</span>owner <span class="token operator">==</span> request<span class="token punctuation">.</span>user
</code></pre></div><p>이제 SnippetDetail 뷰 클래스에서 permission_classes 속성을 편집하여 스니펫 인스턴스의 엔드 포인트에 해당 사용자 지정 권한을 추가 할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span>
                      IsOwnerOrReadOnly<span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsOwnerOrReadOnly
</code></pre></div><p>이제 브라우저를 다시 열면 코드 스니펫을 작성한 동일한 사용자로 로그인 한 경우 'DELETE'및 'PUT'조치가 스니펫 인스턴스 엔드 포인트에만 나타납니다.</p> <h2 id="api로-인증"><a href="#api로-인증" class="header-anchor">#</a> API로 인증</h2> <p>이제 API에 대한 권한 세트가 있으므로 스니펫을 수정하려면 요청을 인증해야 합니다. 인증 클래스를 설정하지 않았으므로 현재 기본값이 적용됩니다. SessionAuthentication 및 BasicAuthentication.</p> <p>웹 브라우저를 통해 API와 상호 작용할 때 로그인 할 수 있으며 브라우저 세션은 요청에 필요한 인증을 제공합니다.</p> <p>프로그래밍 방식으로 API와 상호 작용하는 경우 각 요청에 대해 인증 자격 증명을 명시적으로 제공해야합니다.</p> <p>인증하지 않고 스니펫을 만들려고 하면 오류가 발생합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>http POST http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>snippets<span class="token operator">/</span> code<span class="token operator">=</span><span class="token string">&quot;print(123)&quot;</span>

<span class="token punctuation">{</span>
    <span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Authentication credentials were not provided.&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>앞서 만든 사용자 중 하나의 사용자 이름과 비밀번호를 포함시켜 요청을 성공적으로 수행 할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>http <span class="token operator">-</span>a admin<span class="token punctuation">:</span>password123 POST http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>snippets<span class="token operator">/</span> code<span class="token operator">=</span><span class="token string">&quot;print(789)&quot;</span>

<span class="token punctuation">{</span>
    <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">&quot;owner&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;print(789)&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;linenos&quot;</span><span class="token punctuation">:</span> false<span class="token punctuation">,</span>
    <span class="token string">&quot;language&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;python&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;style&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;friendly&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>이제 웹 API 및 시스템 사용자 및 생성 한 코드 스 니펫에 대한 상당히 세분화 된 권한 세트를 갖습니다.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tool-module/django-rest/tutorial-3-classbase.html" class="prev">
        기초-Class View
      </a></span> <span class="next"><a href="/tool-module/django-rest/tutorial-5-relationship.html">
        기초-관계 &amp; 하이퍼링크
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.226a413b.js" defer></script><script src="/assets/js/2.73abacf5.js" defer></script><script src="/assets/js/78.38e4043b.js" defer></script>
  </body>
</html>
