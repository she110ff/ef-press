<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>쿼리 만들기 | Knowledge Share</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.3cf712f1.css" as="style"><link rel="preload" href="/assets/js/app.226a413b.js" as="script"><link rel="preload" href="/assets/js/2.73abacf5.js" as="script"><link rel="preload" href="/assets/js/25.4f4cd96f.js" as="script"><link rel="prefetch" href="/assets/js/10.351a57cb.js"><link rel="prefetch" href="/assets/js/11.6393c270.js"><link rel="prefetch" href="/assets/js/12.258ce84f.js"><link rel="prefetch" href="/assets/js/13.0e799513.js"><link rel="prefetch" href="/assets/js/14.1bed9505.js"><link rel="prefetch" href="/assets/js/15.d3ebe5dd.js"><link rel="prefetch" href="/assets/js/16.f2f87609.js"><link rel="prefetch" href="/assets/js/17.bbd8a445.js"><link rel="prefetch" href="/assets/js/18.7d163443.js"><link rel="prefetch" href="/assets/js/19.19b5b7f6.js"><link rel="prefetch" href="/assets/js/20.829e3d87.js"><link rel="prefetch" href="/assets/js/21.bc454723.js"><link rel="prefetch" href="/assets/js/22.5c67cf08.js"><link rel="prefetch" href="/assets/js/23.3dec653b.js"><link rel="prefetch" href="/assets/js/24.01bbc434.js"><link rel="prefetch" href="/assets/js/26.3d026ee4.js"><link rel="prefetch" href="/assets/js/27.4c1a5062.js"><link rel="prefetch" href="/assets/js/28.b34493f3.js"><link rel="prefetch" href="/assets/js/29.4370a6f6.js"><link rel="prefetch" href="/assets/js/3.0119ca6e.js"><link rel="prefetch" href="/assets/js/30.9b3ad4ec.js"><link rel="prefetch" href="/assets/js/31.eb5641ed.js"><link rel="prefetch" href="/assets/js/32.eaa85e4f.js"><link rel="prefetch" href="/assets/js/33.f93228ab.js"><link rel="prefetch" href="/assets/js/34.482bd009.js"><link rel="prefetch" href="/assets/js/35.77e80232.js"><link rel="prefetch" href="/assets/js/36.6154cdc8.js"><link rel="prefetch" href="/assets/js/37.ad4220f1.js"><link rel="prefetch" href="/assets/js/38.db259bfc.js"><link rel="prefetch" href="/assets/js/39.31066864.js"><link rel="prefetch" href="/assets/js/4.18b7f171.js"><link rel="prefetch" href="/assets/js/40.2f92ff2c.js"><link rel="prefetch" href="/assets/js/41.434423f6.js"><link rel="prefetch" href="/assets/js/42.b226d007.js"><link rel="prefetch" href="/assets/js/43.4022eb0b.js"><link rel="prefetch" href="/assets/js/44.24df495c.js"><link rel="prefetch" href="/assets/js/45.934df6e3.js"><link rel="prefetch" href="/assets/js/46.3c84a5bb.js"><link rel="prefetch" href="/assets/js/47.fe62c0b5.js"><link rel="prefetch" href="/assets/js/48.8e1b28b6.js"><link rel="prefetch" href="/assets/js/49.56580a1b.js"><link rel="prefetch" href="/assets/js/5.96509959.js"><link rel="prefetch" href="/assets/js/50.5a76b24b.js"><link rel="prefetch" href="/assets/js/51.15eefc48.js"><link rel="prefetch" href="/assets/js/52.288a7c9a.js"><link rel="prefetch" href="/assets/js/53.0344e8e6.js"><link rel="prefetch" href="/assets/js/54.051230fc.js"><link rel="prefetch" href="/assets/js/55.0d6d875f.js"><link rel="prefetch" href="/assets/js/56.cb2d6ed4.js"><link rel="prefetch" href="/assets/js/57.e46f3cc2.js"><link rel="prefetch" href="/assets/js/58.a1265c97.js"><link rel="prefetch" href="/assets/js/59.e43d9167.js"><link rel="prefetch" href="/assets/js/6.eafd2c6f.js"><link rel="prefetch" href="/assets/js/60.f6b21a78.js"><link rel="prefetch" href="/assets/js/61.4a860e23.js"><link rel="prefetch" href="/assets/js/62.6ce4d451.js"><link rel="prefetch" href="/assets/js/63.39c70403.js"><link rel="prefetch" href="/assets/js/64.01d48950.js"><link rel="prefetch" href="/assets/js/65.eff11926.js"><link rel="prefetch" href="/assets/js/66.5f7ada7a.js"><link rel="prefetch" href="/assets/js/67.038d3536.js"><link rel="prefetch" href="/assets/js/68.51d474f1.js"><link rel="prefetch" href="/assets/js/69.7b64006b.js"><link rel="prefetch" href="/assets/js/7.9345f576.js"><link rel="prefetch" href="/assets/js/70.026d7c8c.js"><link rel="prefetch" href="/assets/js/71.23fea48d.js"><link rel="prefetch" href="/assets/js/72.66e45e3c.js"><link rel="prefetch" href="/assets/js/73.fd7cba88.js"><link rel="prefetch" href="/assets/js/74.2b525f65.js"><link rel="prefetch" href="/assets/js/75.fa84901e.js"><link rel="prefetch" href="/assets/js/76.a8d34081.js"><link rel="prefetch" href="/assets/js/77.3cc197c2.js"><link rel="prefetch" href="/assets/js/78.38e4043b.js"><link rel="prefetch" href="/assets/js/79.0233dc04.js"><link rel="prefetch" href="/assets/js/8.c76ec235.js"><link rel="prefetch" href="/assets/js/80.37f9db76.js"><link rel="prefetch" href="/assets/js/81.739c140e.js"><link rel="prefetch" href="/assets/js/82.db22bc06.js"><link rel="prefetch" href="/assets/js/83.e0a3b10f.js"><link rel="prefetch" href="/assets/js/84.165fae16.js"><link rel="prefetch" href="/assets/js/85.deea94b4.js"><link rel="prefetch" href="/assets/js/86.f08273d4.js"><link rel="prefetch" href="/assets/js/87.693b40b0.js"><link rel="prefetch" href="/assets/js/88.4610ab9a.js"><link rel="prefetch" href="/assets/js/89.534d2db6.js"><link rel="prefetch" href="/assets/js/9.f853c54c.js"><link rel="prefetch" href="/assets/js/90.975fdff4.js"><link rel="prefetch" href="/assets/js/91.18312f77.js"><link rel="prefetch" href="/assets/js/92.79d88ce2.js"><link rel="prefetch" href="/assets/js/93.d66f6efe.js"><link rel="prefetch" href="/assets/js/94.3e4c63cd.js"><link rel="prefetch" href="/assets/js/95.95b09757.js"><link rel="prefetch" href="/assets/js/96.588d599f.js"><link rel="prefetch" href="/assets/js/97.21b640fd.js"><link rel="prefetch" href="/assets/js/98.bd06af5f.js"><link rel="prefetch" href="/assets/js/99.8d1cc7e9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3cf712f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Knowledge Share</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frameworks/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/vuejs/" class="nav-link">
  VueJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/django/" class="nav-link router-link-active">
  Django
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nuxtjs/" class="nav-link">
  NuxtJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nestjs/" class="nav-link">
  NestJS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool &amp; Module" class="dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tool &amp; Module" class="mobile-dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool-module/django-rest/" class="nav-link">
  Django-REST
</a></li><li class="dropdown-item"><!----> <a href="/tool-module/clean-arch/" class="nav-link">
  Clean Architecture
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Workflow" class="dropdown-title"><span class="title">Workflow</span> <span class="arrow down"></span></button> <button type="button" aria-label="Workflow" class="mobile-dropdown-title"><span class="title">Workflow</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workflow/nuxtjs-django/" class="nav-link">
  NuxtJS-Django
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frameworks/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/vuejs/" class="nav-link">
  VueJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/django/" class="nav-link router-link-active">
  Django
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nuxtjs/" class="nav-link">
  NuxtJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nestjs/" class="nav-link">
  NestJS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool &amp; Module" class="dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tool &amp; Module" class="mobile-dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool-module/django-rest/" class="nav-link">
  Django-REST
</a></li><li class="dropdown-item"><!----> <a href="/tool-module/clean-arch/" class="nav-link">
  Clean Architecture
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Workflow" class="dropdown-title"><span class="title">Workflow</span> <span class="arrow down"></span></button> <button type="button" aria-label="Workflow" class="mobile-dropdown-title"><span class="title">Workflow</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workflow/nuxtjs-django/" class="nav-link">
  NuxtJS-Django
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Django</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frameworks/django/" aria-current="page" class="sidebar-link">Why Django</a></li><li><a href="/frameworks/django/overview.html" class="sidebar-link">살펴 보기</a></li><li><a href="/frameworks/django/django-install.html" class="sidebar-link">설치 &amp; 프로젝트 생성</a></li><li><a href="/frameworks/django/django-database.html" class="sidebar-link">Database 설치</a></li><li><a href="/frameworks/django/first-app-1.html" class="sidebar-link">First App - 1.Requests and responses</a></li><li><a href="/frameworks/django/first-app-2.html" class="sidebar-link">First App - 2.Models and the admin site</a></li><li><a href="/frameworks/django/model.html" class="sidebar-link">Model 1</a></li><li><a href="/frameworks/django/how-to-query.html" aria-current="page" class="active sidebar-link">쿼리 만들기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#학습목표" class="sidebar-link">학습목표</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#객체-레코드-생성" class="sidebar-link">객체(레코드) 생성</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#saving-changes-to-objects" class="sidebar-link">Saving changes to objects</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#객체-가져오기" class="sidebar-link">객체 가져오기</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#복잡한-필드조회를-위한-q-objects" class="sidebar-link">복잡한 필드조회를 위한 Q objects</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#comparing-objects" class="sidebar-link">Comparing objects</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#deleting-objects" class="sidebar-link">Deleting objects</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#모델-인스턴스-복사하기" class="sidebar-link">모델 인스턴스 복사하기</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#updating-multiple-objects-at-once" class="sidebar-link">Updating multiple objects at once</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#related-objects" class="sidebar-link">Related objects</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#falling-back-to-raw-sql" class="sidebar-link">Falling back to raw SQL</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#filter-a-filter-b-vs-filter-a-b" class="sidebar-link">filter(A).filter(B) vs filter(A, B)</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#select-related-and-prefetch-related" class="sidebar-link">selectrelated and prefetchrelated</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#how-to-join-3-tables-in-query-with-djang" class="sidebar-link">How to join 3 tables in query with Djang</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#annotate-aggregation-and-subquery" class="sidebar-link">annotate, aggregation and subquery</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/how-to-query.html#resources" class="sidebar-link">Resources</a></li></ul></li><li><a href="/frameworks/django/queryset.html" class="sidebar-link">QuerySet API</a></li><li><a href="/frameworks/django/lookup.html" class="sidebar-link">Lookup</a></li><li><a href="/frameworks/django/first-app-3.html" class="sidebar-link">First App - 3.Views and templates</a></li><li><a href="/frameworks/django/first-app-4.html" class="sidebar-link">First App - 4.Forms and generic views</a></li><li><a href="/frameworks/django/first-app-5.html" class="sidebar-link">First App - 5.Testing</a></li><li><a href="/frameworks/django/first-app-6.html" class="sidebar-link">First App - 6.Static files</a></li><li><a href="/frameworks/django/first-app-7.html" class="sidebar-link">First App - 7.Customizing the admin site</a></li><li><a href="/frameworks/django/tests.html" class="sidebar-link">Django Testing Cheat Sheet</a></li><li><a href="/frameworks/django/url-dispatcher.html" class="sidebar-link">URL dispatcher</a></li><li><a href="/frameworks/django/errors.html" class="sidebar-link">Error</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="쿼리-만들기"><a href="#쿼리-만들기" class="header-anchor">#</a> 쿼리 만들기</h1> <p>사용자가 모델을 생성하면 데이터베이스 API(create, retrieve, update, delete) 가능한 API를 사용할 수 있습니다.</p> <h2 id="학습목표"><a href="#학습목표" class="header-anchor">#</a> 학습목표</h2> <ol><li>Create, Retreive, Update, Delete</li> <li>Q 를 사용한 Lookup</li> <li>Copy 모델 인스턴스</li> <li>Related 인스턴스</li> <li>raw SQL</li></ol> <p>이 문서에서는 블로그 앱에 다음과 같은 모델을 만들어 사용하겠습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Blog</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    tagline <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name

<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name

<span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    blog <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Blog<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    headline <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    body_text <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    mod_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    authors <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>Author<span class="token punctuation">)</span>
    number_of_comments <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    number_of_pingbacks <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rating <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>headline
</code></pre></div><p>위의 모델이 테이블로 생성된 모습은 다음의 관계로 설명할 수 있다.</p> <figure><img src="/blog-erd.png"></figure>
[QuickDBD](https://www.quickdatabasediagrams.com/) 에서 작성.
<div class="language-txt extra-class"><pre class="language-text"><code>Blog
______
id PK int
name string
tagline string

Author
______
id PK int
name string
email string

Entry
______
id PK int
blog_id FK &gt;- Blog.id
headline string
body_text string
pub_date date
mod_date
number_of_comments int
number_of_pingbacks int
rating int

EntryAuthor
______
id PK int
entry_id int FK &gt;- Entry.id
author_id int FK &gt;- Author.id

</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py sqlmigrate blog 0001

BEGIN<span class="token punctuation">;</span>
--
-- Create model Author
--
CREATE TABLE <span class="token string">&quot;blog_author&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> serial NOT NULL PRIMARY KEY, 
    <span class="token string">&quot;name&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> NOT NULL, 
    <span class="token string">&quot;email&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">254</span><span class="token punctuation">)</span> NOT NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
--
-- Create model Blog
--
CREATE TABLE <span class="token string">&quot;blog_blog&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> serial NOT NULL PRIMARY KEY, 
    <span class="token string">&quot;name&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> NOT NULL, 
    <span class="token string">&quot;tagline&quot;</span> text NOT NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
--
-- Create model Entry
--
CREATE TABLE <span class="token string">&quot;blog_entry&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> serial NOT NULL PRIMARY KEY, <span class="token string">&quot;headline&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> NOT NULL, 
    <span class="token string">&quot;body_text&quot;</span> text NOT NULL, 
    <span class="token string">&quot;pub_date&quot;</span> <span class="token function">date</span> NOT NULL, 
    <span class="token string">&quot;mod_date&quot;</span> <span class="token function">date</span> NOT NULL, 
    <span class="token string">&quot;number_of_comments&quot;</span> integer NOT NULL, 
    <span class="token string">&quot;number_of_pingbacks&quot;</span> integer NOT NULL, 
    <span class="token string">&quot;rating&quot;</span> integer NOT NULL, 
    <span class="token string">&quot;blog_id&quot;</span> integer NOT NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
CREATE TABLE <span class="token string">&quot;blog_entry_authors&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> serial NOT NULL PRIMARY KEY, 
    <span class="token string">&quot;entry_id&quot;</span> integer NOT NULL, 
    <span class="token string">&quot;author_id&quot;</span> integer NOT NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>

ALTER TABLE <span class="token string">&quot;blog_entry&quot;</span> ADD CONSTRAINT <span class="token string">&quot;blog_entry_blog_id_8cd38d8b_fk_blog_blog_id&quot;</span> FOREIGN KEY <span class="token punctuation">(</span><span class="token string">&quot;blog_id&quot;</span><span class="token punctuation">)</span> REFERENCES <span class="token string">&quot;blog_blog&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> DEFERRABLE INITIALLY DEFERRED<span class="token punctuation">;</span>
CREATE INDEX <span class="token string">&quot;blog_entry_blog_id_8cd38d8b&quot;</span> ON <span class="token string">&quot;blog_entry&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;blog_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ALTER TABLE <span class="token string">&quot;blog_entry_authors&quot;</span> ADD CONSTRAINT <span class="token string">&quot;blog_entry_authors_entry_id_author_id_991f9666_uniq&quot;</span> UNIQUE <span class="token punctuation">(</span><span class="token string">&quot;entry_id&quot;</span>, <span class="token string">&quot;author_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ALTER TABLE <span class="token string">&quot;blog_entry_authors&quot;</span> ADD CONSTRAINT <span class="token string">&quot;blog_entry_authors_entry_id_df89c7c1_fk_blog_entry_id&quot;</span> FOREIGN KEY <span class="token punctuation">(</span><span class="token string">&quot;entry_id&quot;</span><span class="token punctuation">)</span> REFERENCES <span class="token string">&quot;blog_entry&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> DEFERRABLE INITIALLY DEFERRED<span class="token punctuation">;</span>
ALTER TABLE <span class="token string">&quot;blog_entry_authors&quot;</span> ADD CONSTRAINT <span class="token string">&quot;blog_entry_authors_author_id_44edd3c2_fk_blog_author_id&quot;</span> FOREIGN KEY <span class="token punctuation">(</span><span class="token string">&quot;author_id&quot;</span><span class="token punctuation">)</span> REFERENCES <span class="token string">&quot;blog_author&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> DEFERRABLE INITIALLY DEFERRED<span class="token punctuation">;</span>
CREATE INDEX <span class="token string">&quot;blog_entry_authors_entry_id_df89c7c1&quot;</span> ON <span class="token string">&quot;blog_entry_authors&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;entry_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
CREATE INDEX <span class="token string">&quot;blog_entry_authors_author_id_44edd3c2&quot;</span> ON <span class="token string">&quot;blog_entry_authors&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;author_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
COMMIT<span class="token punctuation">;</span>
</code></pre></div><h2 id="객체-레코드-생성"><a href="#객체-레코드-생성" class="header-anchor">#</a> 객체(레코드) 생성</h2> <p>Django는 데이터베이스 테이블을 나타내고 다루기 위해서 모델을 사용합니다. 모델의 인스턴스는 테이블의 레코드 집합을 의미합니다.</p> <p>키워드 인자를 모델 클래스에 전달하여 객체가 생성되고 save()를 호출하면 데이터베이스에 저장이 됩니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Blog<span class="token punctuation">,</span> Author<span class="token punctuation">,</span> Entry
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b1 <span class="token operator">=</span> Blog<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Beatles Blog'</span><span class="token punctuation">,</span> tagline<span class="token operator">=</span><span class="token string">'All the latest Beatles news.'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b1<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b2 <span class="token operator">=</span> Blog<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Cheddar'</span><span class="token punctuation">,</span> tagline<span class="token operator">=</span><span class="token string">'All the latest Cheddar Talk news.'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b2<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>이 경우에는 INSERT 문을 실행하게 되며, save()를 호출하기 전에는 데이터베이스의 영향을 주지 않습니다. save() 는 값을 반환하지 않습니다.</p> <h2 id="saving-changes-to-objects"><a href="#saving-changes-to-objects" class="header-anchor">#</a> Saving changes to objects</h2> <p>변경 값을 저장하기 위해서도 save()를 사용합니다. 다음은 name 의 값을 변경합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Cheddar Talk'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b2<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>이 경우에는 UPDATE 문을 실행하게 됩니다.</p> <h3 id="foreignkey-manytomanyfield-필드-저장"><a href="#foreignkey-manytomanyfield-필드-저장" class="header-anchor">#</a> ForeignKey, ManyToManyField 필드 저장</h3> <p>ForeinKey 필드를 저장하는 것은 일반적인 저장과 동일한 방식입니다.</p> <p>entry 인스턴스의 blog 속성을 변경하고 save() 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>utils <span class="token keyword">import</span> timezone
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e <span class="token operator">=</span> Entry<span class="token punctuation">(</span>body_text<span class="token operator">=</span><span class="token string">'body .... text'</span><span class="token punctuation">,</span> mod_date<span class="token operator">=</span>timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pub_date<span class="token operator">=</span>timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number_of_comments<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> number_of_pingbacks<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> rating<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> blog<span class="token operator">=</span>b<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> entry <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cheese_blog <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;Cheddar Talk&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> entry<span class="token punctuation">.</span>blog <span class="token operator">=</span> cheese_blog
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> entry<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>ManyToManyField 필드의 추가는 약간 다른 방식으로 작동합니다. add() 메소드는 entry 테이블이 아닌 관련 테이블(EntryAuthor)에 레코드를 추가합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Author
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> joe <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;Joe&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> entry<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>add<span class="token punctuation">(</span>joe<span class="token punctuation">)</span>
</code></pre></div><p>다음은 다수의 ManyToManyField 필드를 추가하는 방식입니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> john <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> paul <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;Paul&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> george <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;George&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ringo <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;Ringo&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> entry<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>add<span class="token punctuation">(</span>john<span class="token punctuation">,</span> paul<span class="token punctuation">,</span> george<span class="token punctuation">,</span> ringo<span class="token punctuation">)</span>
</code></pre></div><h2 id="객체-가져오기"><a href="#객체-가져오기" class="header-anchor">#</a> 객체 가져오기</h2> <p>데이터베이스에서 데이터를 가져오기 위해서는 모델 클래스의 매니저를 통해 queryset을 만들어야 합니다.
QuerySet은 데이터베이스의 개체 모음에 대한 API를 의미합니다. 0개 이상의 필터를 가질 수 있습니다. 필터는 주어진 매개 변수에 따라 쿼리 결과를 좁혀 줍니다. SQL 용어에서 QuerySet은 SELECT 문과 같으며 필터는 WHERE 또는 LIMIT와 같은 제한 절입니다.</p> <p>모델은 하나 이상의 매니저를 가지고 있습니다. 기본 매니저는 objects 입니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects
<span class="token operator">&lt;</span>django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models<span class="token punctuation">.</span>manager<span class="token punctuation">.</span>Manager <span class="token builtin">object</span> at <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b <span class="token operator">=</span> Blog<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Foo'</span><span class="token punctuation">,</span> tagline<span class="token operator">=</span><span class="token string">'Bar'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">.</span>objects
Traceback<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
AttributeError<span class="token punctuation">:</span> <span class="token string">&quot;Manager isn't accessible via Blog instances.&quot;</span>
</code></pre></div><p>objects(매니저)는 인스턴스가 아닌 클래스를 통해서만 접근이 가능합니다. 매니저는 QuerySet을 가지고 있습니다. 예를 들어, Blog.objects.all() 은 데이터베이스 Blog 테이블의 모든 개체를 담고 있는 QuerySet을 반환합니다.</p> <h3 id="필터를-통해서-개체-가져오기"><a href="#필터를-통해서-개체-가져오기" class="header-anchor">#</a> 필터를 통해서 개체 가져오기</h3> <p>all()에 의해 반환 된 QuerySet은 데이터베이스 테이블의 전체 개체를 가리킵니다. 그러나 일반적으로 전체 개체 집합의 하위 집합만 선택해야 할 필요가 있습니다.</p> <p>이러한 하위 집합을 만들려면 필터 조건을 추가하여 초기 QuerySet을 구체화 합니다.가장 일반적인 두 가지 방법은 다음과 같습니다.</p> <p>filter (** kwargs) : 주어진 조회(lookup) 매개 변수와 일치하는 개체를 포함하는 새로운 QuerySet을 반환합니다.</p> <p>exclude (** kwargs) : 주어진 조회 매개 변수와 일치하지 않는 개체를 포함하는 새로운 QuerySet을 반환합니다.</p> <p>예를 들어 2006년 발간된 Entry의 QuerySet을 가져 오려면 다음과 같이 filter()를 사용하십시오.</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2006</span><span class="token punctuation">)</span>
</code></pre></div><p>위의 조회와 동일합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2006</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="필터-체이닝"><a href="#필터-체이닝" class="header-anchor">#</a> 필터 체이닝</h4> <p>QuerySet을 구체화 한 결과가 QuerySet이므로 chaining으로 연결해 사용할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     headline__startswith<span class="token operator">=</span><span class="token string">'What'</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     pub_date__gte<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     pub_date__gte<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
</code></pre></div><h4 id="필터의-고유한-querysets"><a href="#필터의-고유한-querysets" class="header-anchor">#</a> 필터의 고유한 QuerySets</h4> <p>QuerySet을 구체화 할 때마다 이전 QuerySet에 바인딩되지 않은 완전히 새로운 QuerySet을 얻게 됩니다. 각 구체화의 결과로 저장, 사용 및 재사용 할 수 있는 별도의 고유한 QuerySet을 작성 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q1 <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>headline__startswith<span class="token operator">=</span><span class="token string">&quot;What&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q2 <span class="token operator">=</span> q1<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>pub_date__gte<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q3 <span class="token operator">=</span> q1<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__gte<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>위 세 개의 QuerySet은 서로 다릅니다. 첫 번째는 &quot;What&quot;로 시작하는 헤드 라인을 포함하는 모든 항목을 포함하는 기본 QuerySet입니다. 두 번째는 첫 번째의 하위 집합이며 pub_date가 오늘 또는 이후인 레코드를 제외하는 추가 기준이 있습니다. 세 번째는 첫 번째의 하위 집합이며 pub_date가 오늘 또는 이후인 레코드만 선택하는 추가 기준이 있습니다. 초기 QuerySet (q1)은 구체화 프로세스의 영향을 받지 않습니다.</p> <h4 id="게으른-querysets"><a href="#게으른-querysets" class="header-anchor">#</a> 게으른 QuerySets</h4> <p>QuerySet은 게으르다 – QuerySet을 만드는 것은 데이터베이스 활동과 관련이 없습니다. 게속해서 필터를 연결하더라도 Django는 QuerySet이 평가 될 때까지 실제로 쿼리를 실행하지 않습니다. 이 예제를 살펴보십시오.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>headline__startswith<span class="token operator">=</span><span class="token string">&quot;What&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__lte<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> q<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>body_text__icontains<span class="token operator">=</span><span class="token string">&quot;food&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
</code></pre></div><p>이것은 세 번의 데이터베이스 hit 처럼 보이지만 실제로 마지막 줄 (print (q))에서 한 번만 데이터베이스에 hit 합니다. 일반적으로 QuerySet의 결과는 &quot;요청&quot;할 때까지 데이터베이스에서 가져 오지 않습니다. 요청하면 데이터베이스에 액세스하여 QuerySet이 평가됩니다. 정확한 평가 시기에 대한 자세한 내용은 <a href="https://docs.djangoproject.com/en/3.0/topics/db/queries/" target="_blank" rel="noopener noreferrer">QuerySet 평가시기<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>를 참조하십시오.</p> <h3 id="get-으로-단일-개체-조회"><a href="#get-으로-단일-개체-조회" class="header-anchor">#</a> get()으로 단일 개체 조회</h3> <p>filter()는 단일 개체만 쿼리와 일치하더라도 QuerySet을 항상 제공합니다.이 경우 단일 요소를 포함하는 QuerySet이 됩니다.</p> <p>쿼리와 일치하는 개체가 하나만 있는 경우 Manager에서 객체를 직접 반환하는 get() 메서드를 사용할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> one_entry <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>get() 사용과  filter()네서 [0] 슬라이스로 사용에는 차이가 있습니다. 쿼리와 일치하는 결과가 없으면 get()은 DoesNotExist 예외를 발생시킵니다. 이 예외는 쿼리가 수행되는 모델 클래스의 속성이므로 위 코드에서 기본 키가 1 인 Entry 개체가 없으면 Django는 Entry.DoesNotExist를 발생시킵니다.</p> <p>마찬가지로 둘 이상의 항목이 get() 쿼리와 일치하면 MultipleObjectsReturned가 발생합니다.</p> <h3 id="queryset-메소드"><a href="#queryset-메소드" class="header-anchor">#</a> QuerySet 메소드</h3> <p>대부분 데이터베이스에서 객체를 찾아야 할 때 all(), get(), filter() 및 exclude()를 사용합니다. 다양한 QuerySet 메소드의 전체 목록은 <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#queryset-api-reference" target="_blank" rel="noopener noreferrer">QuerySet API Reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>를 참조하십시오.</p> <h3 id="querysets-분할-조회"><a href="#querysets-분할-조회" class="header-anchor">#</a> QuerySets 분할 조회</h3> <p>Python의 배열 분할(slice) 구문으로 QuerySet을 하위 집합을 조회할 수 있습니다. 이는 SQL의 LIMIT 및 OFFSET 절과 동일합니다.</p> <p>처음 5개 개체를 반환합니다. (LIMIT 5)</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>
</code></pre></div><p>6부터 10까지의 개체를 반환합니다. (OFFSET 5 LIMIT 5)</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
</code></pre></div><p>음수 인덱싱 (즉, Entry.objects.all () [-1])은 지원되지 않습니다.</p> <p>일반적으로 QuerySet을 슬라이스하면 새 QuerySet이 반환되며 쿼리를 평가하지 않습니다. Python 슬라이스 구문의 &quot;step&quot;매개 변수를 사용하는 경우는 예외입니다. 예를 들어, 처음 10 개의 모든 두 번째 객체 목록을 반환하기 위해 실제로 쿼리를 실행합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
</code></pre></div><p>슬라이스 된 쿼리 세트의 추가 필터링 또는 ordering은 작동 방식의 모호한 특성으로 인해 금지됩니다.</p> <p>목록이 아닌 단일 객체를 검색하려면 (예 : SELECT foo FROM bar LIMIT 1) 슬라이스 대신 인덱스를 사용하십시오. 예를 들어, 제목을 기준으로 사전 순으로 항목을 정렬 한 후 데이터베이스의 첫 번째 항목을 반환합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'headline'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre></div><p>위와 같은 결과를 얻게 됩니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'headline'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>지정된 기준과 일치하는 개체가 없으면 첫 번째는 order_by는 IndexError를 발생시키고 두 번째는 get()은 DoesNotExist를 발생 시킵니다.</p> <h3 id="필드-lookups"><a href="#필드-lookups" class="header-anchor">#</a> 필드 lookups</h3> <p>필드 조회(lookup)는 SQL WHERE 절을 지정하는 방법입니다. 이들은 QuerySet 메소드 filter(), exclude() 및 get()에 키워드 인수로 지정됩니다.</p> <p>기본 조회 키워드 인수는 field__lookuptype = value 형식을 사용합니다. (이중 밑줄을 사용합니다). 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__lte<span class="token operator">=</span><span class="token string">'2006-01-01'</span><span class="token punctuation">)</span>
</code></pre></div><p>다음과 같은 SQL로 변환이 됩니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>SELECT <span class="token operator">*</span> FROM blog_entry WHERE pub_date <span class="token operator">&lt;=</span> <span class="token string">'2006-01-01'</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>파이썬은 런타임에 이름과 값이 평가되는 임의의 키워드 인수(이름-값, **kwargs)를 허용하는 함수를 정의 할 수 있습니다.</p></div> <p>조회에 지정된 필드는 모델 필드의 이름이어야 합니다. 단, ForeignKey의 경우 _id 접미사로 필드 이름을 지정할 수 있습니다. 이 경우 value 매개 변수는 외부 모델 기본 키의 원시 값을 포함해야합니다. 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre></div><p>잘못된 키워드 인수를 전달하면 조회 함수가 TypeError를 발생 시킵니다.</p> <p>데이터베이스 Lookup Field API는 약 24 가지 조회 유형을 지원합니다. 전체 참조는 <a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/#field-lookups" target="_blank" rel="noopener noreferrer">Lookup Field Ref<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 찾을 수 있습니다.</p> <p>자주 사용되는 몇가지를 살펴 보겠습니다.
exact :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>headline__exact<span class="token operator">=</span><span class="token string">&quot;Cat bites dog&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>다음과 같은 SQL이 생성될 것 입니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>SELECT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> WHERE headline <span class="token operator">=</span> <span class="token string">'Cat bites dog'</span><span class="token punctuation">;</span>
</code></pre></div><p>조회 유형(lookup type)을 제공하지 않는 경우, 즉 키워드 인수에 이중 밑줄이 없는 경우 조회 유형은 exact 으로 간주됩니다</p> <p>iexact : case-insensitive match</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name__iexact<span class="token operator">=</span><span class="token string">&quot;beatles blog&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>&quot;Beatles Blog&quot;, &quot;beatles blog&quot;또는 &quot;BeAtlES blOG&quot;라는 제목의 블로그와 일치합니다.</p> <p>contains : Case-sensitive containment</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">)</span>
</code></pre></div><p>대소 문자를 구분하지 않는 버전 인 icontain도 있습니다.</p> <p>startswith, endswith : 각각 시작, 끝을 검색합니다. istartswith 및 iendswith라는 대소 문자를 구분하지 않는 버전도 있습니다.</p> <h3 id="필드-조회의-관계-확장"><a href="#필드-조회의-관계-확장" class="header-anchor">#</a> 필드 조회의 관계 확장</h3> <p>Django는 SQL JOIN을 자동으로 관리하면서 조회(lookup)에서 관계(relationship)를 &quot;따르가는&quot; 강력하고 직관적인 방법을 제공합니다. 관계를 확장하려면 원하는 필드에 도달 할 때까지 모델에서 관련 필드 이름을 이중 밑줄로 구분하여 사용합니다.</p> <p>이 예제는 이름이 'Beatles Blog'인 Blog를 가진 모든 Entry 개체를 검색합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog__name<span class="token operator">=</span><span class="token string">'Beatles Blog'</span><span class="token punctuation">)</span>
</code></pre></div><p>이 범위는 원하는 만큼 깊을 수 있습니다.</p> <p>역으로도 작동합니다. &quot;역방향&quot; 관계를 참조하려면 모델의 소문자 이름을 사용하십시오.</p> <p>이 예제는 headline 에 'Lennon'이 포함 된 하나 이상의 Entry를 포함하는 모든 Blog 개체를 검색합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>entry__headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">)</span>
</code></pre></div><p>여러 관계에서 필터링할 때, 중간 모델 중 하나에 필터 조건을 충족하는 값이 없는 경우 Django는 비어있는 (모든 값이 NULL 임) 값으로 그러나 유효한 오브젝트 인 것처럼 처리합니다. 오류가 발생하지 않습니다. 예를 들어</p> <div class="language-python extra-class"><pre class="language-python"><code>Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>entry__authors__name<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">)</span>
</code></pre></div><p>(관련 Author모델 이있는 경우) author 항목과 연관된 항목 name 이 없으면 누락으로 인해 오류가 발생 하지 않고 첨부 된 항목이 없는 것처럼 처리됩니다. 혼란스러울 수 있는 유일한 경우는 isnull 사용하는 경우 입니다. :</p> <div class="language-python extra-class"><pre class="language-python"><code>Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>entry__authors__name__isnull<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>author가 비어 있는 name을 가지고 있고, 또한(and) entry가 비어 있는 author를 가지고 있는 blog 개체를 반환합니다. 만약 entry가 비어 있는 author를 가지고 있는 blog 개체 원하지 않으면 다음과 같이 쓸 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>entry__authors__isnull<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> entry__authors__name__isnull<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="multi-valued-필터로-관계-확장"><a href="#multi-valued-필터로-관계-확장" class="header-anchor">#</a> multi-valued 필터로 관계 확장</h4> <p>ManyToManyField 또는 reverse ForeignKey의 객체를 필터링 하는 경우, 필터는 두 가지 종류가 있습니다.  Blog, Entry의 관계를 생각해 보면( Blog는 Entry에 일 대 다 관계입니다).</p> <p>headline에 &quot;Lennon&quot;이 있고 2008년에 출판 된 항목(pub_date)이 있는 블로그를 찾는 데 관심이 있을 수 있습니다. 또는 headline에 &quot;Lennon&quot; 이 있는 항목에서 2008년에 출판 된 항목(pub_date)이 있는  블로그 항목을 찾을 수도 있습니다.</p> <p>첫번째 쿼리:</p> <div class="language-python extra-class"><pre class="language-python"><code>Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>entry__headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">,</span> entry__pub_date__year<span class="token operator">=</span><span class="token number">2008</span><span class="token punctuation">)</span>
</code></pre></div><p>두번째 쿼리:</p> <div class="language-python extra-class"><pre class="language-python"><code>Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>entry__headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>entry__pub_date__year<span class="token operator">=</span><span class="token number">2008</span><span class="token punctuation">)</span>
</code></pre></div><p>&quot;Lennon&quot; 을 모두 가지고 있는 두 개의 entry가 한 블로그에 연결되어 있다고 하겠습니다. 그러나 이 중에 어떤 entry 도 2008 년이 아닙니다. 이때, 첫 번째 쿼리는 블로그를 반환하지 않지만 두 번째 쿼리는 해당 블로그를 반환합니다.</p> <p>두 번째 예에서 첫 번째 필터 는 headlin 에서 “Lennon”이 있는 entry에 연결된 모든 블로그로 쿼리 세트를 제한합니다. 두 번째 필터는 2008 년에 게시 된 entry에 연결된 블로그로 제한합니다. 두 번째 필터에 의해 선택된 entry는 첫 번째 필터의 entry와 같거나 같지 않을 수 있습니다. Entry를 필터링하는 것이 아니라 각 필터와 연결된 Blog 를 필터링하는 것 입니다.</p> <p>multi-value relationships에서 exclude()는 위에서 언급한 filter()의 같은 방식으로 작동하지는 않습니다. exclude() 경우는 모든 lookup을 다 만족할 필요가 없습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>
    entry__headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">,</span>
    entry__pub_date__year<span class="token operator">=</span><span class="token number">2008</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><p>filter() 동작과 달리 두 조건을 모두 만족하는 entry를 기반으로 블로그를 제한 하지는 않습니다. 반대로 제한하기 위해서는 아래와 같이 두 가지 쿼리를 작성해야 합니다</p> <div class="language-python extra-class"><pre class="language-python"><code>Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>
    entry__in<span class="token operator">=</span>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>
        headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">,</span>
        pub_date__year<span class="token operator">=</span><span class="token number">2008</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="모델-필드를-참조하는-필터"><a href="#모델-필드를-참조하는-필터" class="header-anchor">#</a> 모델 필드를 참조하는 필터</h3> <p>지금까지 제공된 예에서는 모델 필드의 값을 상수와 비교하는 필터를 구성했습니다. 그러나 모델 필드의 값을 동일한 모델의 다른 필드와 비교하려면 어떻게 해야합니까?</p> <p>Django는 F expressions을 사용하여 그러 비교를 사용할 수 있습니다. F() 인스턴스는 쿼리 내에서 모델 필드에 대한 참조 역할을 합니다. 이러한 참조를 쿼리 필터에서 사용하여 동일한 모델 인스턴스에서 서로 다른 두 필드의 값을 비교할 수 있습니다.</p> <p>예를 들어, pingbacks 보다 더 큰 number_of_comments 이 있는 entry 의 목록을 찾으려면 number_of_pingbacks를 참조 할 F() 객체를 구성하고 쿼리에서 해당 객체를 사용 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>number_of_comments__gt<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'number_of_pingbacks'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Django는 상수, F()객체와 함께 더하기, 빼기, 곱하기, 나누기, 모듈로 및 거듭 제곱 연산을 지원 합니다. pingbacks 보다 두 배 이상의 주석이 있는 모든 entry를 찾으려면 쿼리를 다음과 같이 작성합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>number_of_comments__gt<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'number_of_pingbacks'</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>rating이 number_of_pingbacks, number_of_comments 수의 합 보다 작은 모든 entry을 찾으려면 다음과 같이 쿼리를 작성 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>rating__lt<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'number_of_comments'</span><span class="token punctuation">)</span> <span class="token operator">+</span> F<span class="token punctuation">(</span><span class="token string">'number_of_pingbacks'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>이중 밑줄 표기법을 사용하여 F()개체의 관계를 확장 할 수도 있습니다 . 이중 밑줄 객체을 포함하는 F()는 관련 개체에 접근하는 데 필요한 조인 나타냅니다. 예를 들어, Author 이름이 Blog 이름과 동일한 모든 entry을 검색하기 위해 다음과 같은 쿼리를 작성 할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>authors__name<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'blog__name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>날짜 및 날짜/시간 필드의 경우 timedelta 개체를 추가하거나 뺄 수 있습니다. 다음은 게시 된 후 3 일 이후에 수정 된 모든 entry를 반환합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mod_date__gt<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'pub_date'</span><span class="token punctuation">)</span> <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>F()객체에 의해 비트 연산을 지원 .bitand(), .bitor(), .bitrightshift(),와 .bitleftshift(). 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> F<span class="token punctuation">(</span><span class="token string">'somefield'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>bitand<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="pk-필드-조회-shortcut"><a href="#pk-필드-조회-shortcut" class="header-anchor">#</a> pk 필드 조회 shortcut</h3> <p>편의상 Django는 pk(기본 키)를 나타내는 shortcut을 제공합니다.</p> <p>예제 Blog 모델에서 기본 키는 id 필드 이므로 이 세 명령문은 동일합니다</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>id__exact<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token comment"># Explicit form</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token comment"># __exact is implied</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token comment"># pk implies id__exact</span>
</code></pre></div><p>pk 사용은  __exact 쿼리에만 국한되지 않습니다. pk는 쿼리 용어를 결합하여 모델의 기본 키에서 쿼리를 수행 할 수 있습니다 .</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Get blogs entries with id 1, 4 and 7</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Get all blog entries with id &gt; 14</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gt<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
</code></pre></div><p>pk 조회(lookup)는 join 에서도 작동합니다. 예를 들어, 이 세 문장은 동일합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog__id__exact<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># Explicit form</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog__id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token comment"># __exact is implied</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog__pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token comment"># __pk implies __id__exact</span>
</code></pre></div><h3 id="백분율-기호와-밑줄-이스케이프"><a href="#백분율-기호와-밑줄-이스케이프" class="header-anchor">#</a> 백분율 기호와 밑줄 이스케이프</h3> <p>LIKE 조회를 SQL 문에 사용하는 경우에 ( iexact, contains, icontains, startswith, istartswith, endswith 와 iendswith), 두 개의 특수 문자, 퍼센트 기호와 밑줄을 자동으로 이스케이프 합니다.  퍼센트 기호는 여러 문자 와일드 카드와 밑줄은 의미 단일 문자 와일드 카드를 의미가 있습니다.</p> <p>예를 들어, 백분율 기호가 포함 된 모든 항목을 검색하려면 백분율 기호를 사용할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>headline__contains<span class="token operator">=</span><span class="token string">'%'</span><span class="token punctuation">)</span>
</code></pre></div><p>결과 SQL은 다음과 같습니다. 밑줄도 마찬가지입니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>SELECT <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> WHERE headline LIKE <span class="token string">'%\%%'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="캐싱과-querysets"><a href="#캐싱과-querysets" class="header-anchor">#</a> 캐싱과 QuerySets</h3> <p>각각 QuerySet은 데이터베이스 액세스를 최소화하기 위한 캐시를 포함합니다. 작동 방식을 이해하면 가장 효율적인 코드를 작성할 수 있습니다.</p> <p>새로 작성된 QuerySet에서 캐시가 비어 있습니다. 처음 QuerySet을 평가할 때 ( 따라서 데이터베이스 쿼리가 발생하면) Django는 쿼리 결과를 QuerySet 캐시에 저장하고 명시적으로 요청 된 결과 (예 : QuerySet 반복되는 경우 다음 요소)를 반환합니다.</p> <p>예를 들어, 다음은 두 개의 QuerySet을 만들어 평가하고 버립니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>headline <span class="token keyword">for</span> e <span class="token keyword">in</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>e<span class="token punctuation">.</span>pub_date <span class="token keyword">for</span> e <span class="token keyword">in</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>즉, 동일한 데이터베이스 쿼리가 두 번 실행되어 데이터베이스 hit이 두 배가 됩니다. 또한 두 Entry  요청 사이에 초 단위로 추가되거나 삭제되었을 수 있으므로 동일한 데이터베이스 레코드가 포함되지 않을 수 있습니다.</p> <p>이 문제를 피하려면  QuerySet를 저장하고 재사용 하십시오.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> queryset <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span>headline <span class="token keyword">for</span> p <span class="token keyword">in</span> queryset<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Evaluate the query set.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span>pub_date <span class="token keyword">for</span> p <span class="token keyword">in</span> queryset<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Re-use the cache from the evaluation.</span>
</code></pre></div><h4 id="캐싱-되지-안는-querysets"><a href="#캐싱-되지-안는-querysets" class="header-anchor">#</a> 캐싱 되지 안는 QuerySets</h4> <p>QuerySets이 항상 결과를 캐시하지는 않습니다. QuerySets의 일부만 평가할 때 캐시가 검사는 되지만 캐시가 채워지지 않습니다. 특히, 배열의 슬라이스 또는 인덱스를 사용하여 쿼리 집합을 제한하면 캐시가 채워지지 않습니다.</p> <p>예를 들어 QuerySets 객체에서 특정 인덱스를 반복적으로 가져오면 매번 데이터베이스를 쿼리합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> queryset <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>queryset<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Queries the database</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>queryset<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Queries the database again</span>
</code></pre></div><p>그러나 전체 쿼리 세트가 이미 평가 된 경우 캐시가 대신 검사됩니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> queryset <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>entry <span class="token keyword">for</span> entry <span class="token keyword">in</span> queryset<span class="token punctuation">]</span> <span class="token comment"># Queries the database</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>queryset<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Uses cache</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>queryset<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># Uses cache</span>
</code></pre></div><p>다음은 전체 쿼리 세트가 평가되어 캐시를 채우는 다른 작업의 예 입니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>entry <span class="token keyword">for</span> entry <span class="token keyword">in</span> queryset<span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">(</span>queryset<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> entry <span class="token keyword">in</span> queryset
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">(</span>queryset<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>QuerySets 인쇄하는 것만으로는 캐시가 채워지지 않습니다. <strong>repr</strong>()를 호출하여 전체 쿼리 집합의 슬라이스만 반환하기 때문 입니다.</p></div> <h2 id="복잡한-필드조회를-위한-q-objects"><a href="#복잡한-필드조회를-위한-q-objects" class="header-anchor">#</a> 복잡한 필드조회를 위한 Q objects</h2> <p>filter() 등의 키워드 인수 쿼리 는 &quot;AND&quot;로 되어 있습니다. 보다 복잡한 쿼리 (예 : OR문이있는 쿼리)를 실행해야하는 경우 Q objects을 사용할 수 있습니다.</p> <p>Q object(django.db.models.Q)는 키워드 인자의 컬렉션을 캡슐화하는 데 사용되는 개체입니다. 이러한 키워드 인수는 위의 &quot;필드 조회&quot;와 같이 지정됩니다.</p> <p>예를 들어 다음의 Q 개체는 단일 LIKE 쿼리를 캡슐화 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q
Q<span class="token punctuation">(</span>question__startswith<span class="token operator">=</span><span class="token string">'What'</span><span class="token punctuation">)</span>
</code></pre></div><p>Q 개체는 &amp; 및 | 연산자를 사용하여 객체를 결합 할 수 있습니다. 연산자가 두 Q개체에 사용되면 새로운 하나의 Q개체가 생성됩니다.</p> <p>예를 들어 이 명령문은 두개의 Q &quot;question__startswith&quot;쿼리 의 &quot;OR&quot;을 나타내는 단일 객체를 생성 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Q<span class="token punctuation">(</span>question__startswith<span class="token operator">=</span><span class="token string">'Who'</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>question__startswith<span class="token operator">=</span><span class="token string">'What'</span><span class="token punctuation">)</span>
</code></pre></div><p>이것은 다음 SQL WHERE절 과 동일합니다 .</p> <div class="language-python extra-class"><pre class="language-python"><code>WHERE question LIKE <span class="token string">'Who%'</span> OR question LIKE <span class="token string">'What%'</span>
</code></pre></div><p>임의의 복잡한 문장을 구성 할 수 Q와 객체 &amp; 및 | 연산자를 괄호 그룹으로 묶어서 사용할 수 있습니다. 또한 일반 쿼리 ~ 부정쿼리를 모두 결합한 조합 조회가 가능 합니다</p> <div class="language-python extra-class"><pre class="language-python"><code>Q<span class="token punctuation">(</span>question__startswith<span class="token operator">=</span><span class="token string">'Who'</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">~</span>Q<span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2005</span><span class="token punctuation">)</span>
</code></pre></div><p>키워드 인수를 사용하는 각각의 조회 기능 (예를 들어 filter(), exclude(), get()) 에 하나 이상의 인수로 개체로 전달 될 수 있습니다.조회 함수에 여러  Q 객체 인수를 제공하면 인수가 &quot;AND&quot;가됩니다. 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Poll<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
    Q<span class="token punctuation">(</span>question__startswith<span class="token operator">=</span><span class="token string">'Who'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>대략 다음과 같은 SQL이 작성됩니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>SELECT <span class="token operator">*</span> <span class="token keyword">from</span> polls WHERE question LIKE <span class="token string">'Who%'</span>
    AND <span class="token punctuation">(</span>pub_date <span class="token operator">=</span> <span class="token string">'2005-05-02'</span> OR pub_date <span class="token operator">=</span> <span class="token string">'2005-05-06'</span><span class="token punctuation">)</span>
</code></pre></div><p>조회 함수는 Q객체와 키워드 인수를 혼합하여 사용할 수 있습니다 . 조회 함수에 제공된 모든 인수 (키워드 인수 또는 Q 객체)는 &quot;AND&quot;로 함께 표시됩니다. 그러나 Q객체가 제공되는 경우 키워드 인수의 정의보다 우선해야합니다. 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Poll<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
    Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    question__startswith<span class="token operator">=</span><span class="token string">'Who'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><p>이전 예제와 동등한 쿼리 같지만 그러나 유효하지 않습니다.:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># INVALID QUERY</span>
Poll<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
    question__startswith<span class="token operator">=</span><span class="token string">'Who'</span><span class="token punctuation">,</span>
    Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="comparing-objects"><a href="#comparing-objects" class="header-anchor">#</a> Comparing objects</h2> <p>두 모델 인스턴스를 비교하려면 표준 Python 비교 연산자인 double equals sign(==)을 사용하십시오. 내부적으로 두 모델의 기본 키 값을 비교합니다</p> <p>위 Entry의 예를 사용하면 다음 두 문장은 동일합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> some_entry <span class="token operator">==</span> other_entry
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> some_entry<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> other_entry<span class="token punctuation">.</span><span class="token builtin">id</span>
</code></pre></div><p>모델의 기본 키가 id로 호출되지 않으도 문제가 없습니다. 비교는 항상 기본 키를 사용합니다. 예를 들어, 모델의 기본 키 필드가 name이면 다음 두 명령문은 동일합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> some_obj <span class="token operator">==</span> other_obj
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> some_obj<span class="token punctuation">.</span>name <span class="token operator">==</span> other_obj<span class="token punctuation">.</span>name
</code></pre></div><h2 id="deleting-objects"><a href="#deleting-objects" class="header-anchor">#</a> Deleting objects</h2> <p>삭제 메소드는 delete() 입니다. 이 메소드는 즉시 개체를 삭제하고 삭제 된 개체수와 개체 유형 당 삭제 수가 있는 dictionary를 리턴합니다. 예:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'weblog.Entry'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>개체를 대량으로 삭제할 수도 있습니다. 모든 QuerySet 메소드에는 해당 delete()를 가지고 있습니다.</p> <p>예를 들어  pub_date가 2005년의 모든 Entry 개체가 삭제됩니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2005</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'webapp.Entry'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Django가 객체를 삭제하면 기본적으로 SQL 제약 ON DELETE CASCADE 조건의 동작을 에뮬레이트합니다. 즉, 삭제할 객체를 가리키는 외래 키가 있는 객체는 함께 삭제됩니다. 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># This will delete the Blog and all of its Entry objects.</span>
b<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>이 CASCADE 동작은 ForeignKey에 대한 on_delete인수를 통해 사용자 지정할 수 있습니다.</p> <p>delete()는 오직 QuerySet만 있으며 Manager에 노출되지 않습니다. 이는 실수로 Entry.objects.delete()하고 모든 항목을 삭제 하지 못하도록 하는 안전 메커니즘 입니다. 모든 개체를 삭제하려면, 명시적으로 완전한 쿼리 세트를 요청해야 합니다.:</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="모델-인스턴스-복사하기"><a href="#모델-인스턴스-복사하기" class="header-anchor">#</a> 모델 인스턴스 복사하기</h2> <p>모델 인스턴스를 복사하기 위한 기본 제공 방법이 없지만 모든 필드 값을 복사하여 새 인스턴스를 쉽게 만들 수 있습니다. 가장 간단한 방법은 pk 설정을 None 으로 하는 것 입니다. 블로그 예제 사용:</p> <div class="language-python extra-class"><pre class="language-python"><code>blog <span class="token operator">=</span> Blog<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'My blog'</span><span class="token punctuation">,</span> tagline<span class="token operator">=</span><span class="token string">'Blogging is easy'</span><span class="token punctuation">)</span>
blog<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># blog.pk == 1</span>

blog<span class="token punctuation">.</span>pk <span class="token operator">=</span> <span class="token boolean">None</span>
blog<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># blog.pk == 2</span>
</code></pre></div><p>상속을 사용하면 상황이 복잡해집니다. 다음과 같은 Blog의 하위 클래스를 고려하면,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ThemeBlog</span><span class="token punctuation">(</span>Blog<span class="token punctuation">)</span><span class="token punctuation">:</span>
    theme <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>

django_blog <span class="token operator">=</span> ThemeBlog<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Django'</span><span class="token punctuation">,</span> tagline<span class="token operator">=</span><span class="token string">'Django is easy'</span><span class="token punctuation">,</span> theme<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">)</span>
django_blog<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># django_blog.pk == 3</span>
</code></pre></div><p>상속이 작동하는 방식으로 인해 pk 와 id 를 모두 None으로 설정해야 합니다</p> <div class="language-python extra-class"><pre class="language-python"><code>django_blog<span class="token punctuation">.</span>pk <span class="token operator">=</span> <span class="token boolean">None</span>
django_blog<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token boolean">None</span>
django_blog<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># django_blog.pk == 4</span>
</code></pre></div><p>이 프로세스는 모델의 데이터베이스 테이블에 포함되지 않은 관계를 복사하지 않습니다. 예를 들어, Entry가 Author에 대해 ManyToManyField 를 가지고 있습니다. entry를 복제 한 후에는 새 entry에 대해 다 대 다 관계를 설정 해야합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>entry <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment"># some previous entry</span>
old_authors <span class="token operator">=</span> entry<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
entry<span class="token punctuation">.</span>pk <span class="token operator">=</span> <span class="token boolean">None</span>
entry<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
entry<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>old_authors<span class="token punctuation">)</span>
</code></pre></div><p>OneToOneField의 경우 일대일 고유 제한 조건을 위반하지 않도록 관련 개체를 복제하고 새 개체를 만들어 필드에 지정해야 합니다. 다음의 예는, 위에서 이미 entry 가 복제 되었다고 가정합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>detail <span class="token operator">=</span> EntryDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
detail<span class="token punctuation">.</span>pk <span class="token operator">=</span> <span class="token boolean">None</span>
detail<span class="token punctuation">.</span>entry <span class="token operator">=</span> entry
detail<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="updating-multiple-objects-at-once"><a href="#updating-multiple-objects-at-once" class="header-anchor">#</a> Updating multiple objects at once</h2> <p>때로의 QuerySet안에 있는 모든 개체에 대해 특정 값으로 필드를 설정하려고 할 때가 있습니다. 이는  update() 메소드로 작업을 수행 할 수 있습니다. 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#pub_date 가 2007인 모든 headlines 을 변경합니다.</span>
Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span><span class="token number">2007</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>headline<span class="token operator">=</span><span class="token string">'Everything is the same'</span><span class="token punctuation">)</span>
</code></pre></div><p>이 메소드를 사용하여 비 관계형 필드 및 ForeignKey 필드만 설정할 수 있습니다. 비 관계형 필드의 값을 변경하려면 새 값을 상수로 제공하십시오. ForeignKey 필드의 값을 변경하려면 모델 인스턴스로 설정할 수 있습니다. 예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Change every Entry so that it belongs to this Blog.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>blog<span class="token operator">=</span>b<span class="token punctuation">)</span>
</code></pre></div><p>이 update()메서드는 즉시 적용되며 쿼리와 일치하는 행 수를 반환합니다 (일부 행에 이미 새 값이있는 경우 업데이트 된 행 수와 같지 않을 수 있음). QuerySet업데이트되는 것에 대한 유일한 제한 은 하나의 데이터베이스 테이블 (모델의 기본 테이블)에만 액세스 할 수 있다는 것입니다. 관련 필드를 기준으로 필터링 할 수 있지만 모델의 기본 테이블에서 열만 업데이트 할 수 있습니다. 예:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Update all the headlines belonging to this Blog.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog<span class="token operator">=</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>headline<span class="token operator">=</span><span class="token string">'Everything is the same'</span><span class="token punctuation">)</span>
</code></pre></div><p>주의하십시오 update()방법은 SQL 문에 직접 변환됩니다. 직접 업데이트를위한 대량 작업입니다. 그것은 어떤 실행되지 않습니다 save()귀하의 모델 방법을, 또는 방출 pre_save또는 post_save(호출의 결과입니다 신호 save()) 또는 명예 auto_now필드 옵션을 선택합니다. 에 모든 항목을 저장하고 각 인스턴스 QuerySet 에서 save()메소드가 호출 되는지 확인 하려는 경우 이를 처리하기 위해 특별한 기능이 필요하지 않습니다. 그들을 반복하고 전화 save():</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> item <span class="token keyword">in</span> my_queryset<span class="token punctuation">:</span>
    item<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>업데이트 호출 은 모델의 다른 필드 값을 기반으로 한 필드를 업데이트 하는데도 사용할 수 있습니다 . 이것은 현재 값을 기준으로 카운터를 증가시킬 때 특히 유용합니다. 예를 들어 블로그의 모든 항목에 대해 핑백 수를 늘리려면 다음을 수행하십시오.F expressions</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>number_of_pingbacks<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'number_of_pingbacks'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>그러나 F()filter 및 exclude 절의 객체 와 달리 F()업데이트에서 객체 를 사용할 때 조인을 도입 할 수 없습니다 . 업데이트중인 모델의 로컬 필드 만 참조 할 수 있습니다. F()객체 와의 조인을 시도하면 a FieldError가 발생합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># This will raise a FieldError</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>update<span class="token punctuation">(</span>headline<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'blog__name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="related-objects"><a href="#related-objects" class="header-anchor">#</a> Related objects</h2> <p>모델의 관계를 정의 할 때 (즉, ForeignKey, OneToOneField나 ManyToManyField), 모델의 인스턴스들은 관련 개체에 액세스할 수 있는 API를 갖게 됩니다.</p> <p>이 페이지의 상단에 있는 모델을 사용하여, 예를 들어, Entry객체는 e는  blog의 속성 e.blog에 접근하여 Blog 개체를 관련 얻을 수 있었습니다.</p> <p>Django는 또한 “다른” 관계의 측면에 대한 API 접근자를 만듭니다. 관련 모델에서 관계를 정의하는 모델로의 링크입니다. 예를 들어, Blog객체 b는  entry_set(b.entry_set.all()) 통해 Entry 관련 객체의 목록에 액세스 할 수 있습니다.</p> <h3 id="one-to-many-relationships"><a href="#one-to-many-relationships" class="header-anchor">#</a> One-to-many relationships</h3> <h4 id="forward"><a href="#forward" class="header-anchor">#</a> Forward</h4> <p>모델에 ForeignKey가 있는 경우 해당 모델의 인스턴스는 모델의 속성을 통해 관련(외부) 객체에 액세스 할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>blog <span class="token comment"># Returns the related Blog object.</span>
</code></pre></div><p>외래 키의 속성을 통해 가져오고 설정할 수 있습니다. 외래 키에 대한 변경 사항은 save()을 호출 할 때까지 데이터베이스에 저장되지 않습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>blog <span class="token operator">=</span> some_blog
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>ForeignKey 필드가  null=True 인 경우(즉, NULL값을 수 설정 있는), None 을 할당하여 관계를 제거 할 수 있습니다. 예:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>blog <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># &quot;UPDATE blog_entry SET blog_id = NULL ...;&quot;</span>
</code></pre></div><p>일대 다 관계에 정방향 액세스는 관련 개체에 처음 액세스 할 때 캐시됩니다. 동일한 객체 인스턴스에서 외래 키에 대한 후속 액세스에서는 캐시된 개체에 접근합니다. 예:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>blog<span class="token punctuation">)</span>  <span class="token comment"># Hits the database to retrieve the associated Blog.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>blog<span class="token punctuation">)</span>  <span class="token comment"># Doesn't hit the database; uses cached version.</span>
</code></pre></div><p>다음 방법은 모든 일대 다 관계의 캐시를 미리 재귀 적으로 미리 채 웁니다. 예:select_related() QuerySet</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> e <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>blog<span class="token punctuation">)</span>  <span class="token comment"># Doesn't hit the database; uses cached version.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>blog<span class="token punctuation">)</span>  <span class="token comment"># Doesn't hit the database; uses cached version.</span>
</code></pre></div><h4 id="following-relationships-backward"><a href="#following-relationships-backward" class="header-anchor">#</a> Following relationships “backward”</h4> <p>모델에 ForeignKey가 있는 경우 외래 키 모델의 인스턴스는 첫 번째 모델의 모든 인스턴스를 반환 하는에 액세스 할 수 있습니다. 기본적으로 Manager 이름은 FOO_set이며 여기서 FOO는 소스 모델 이름으로 소문자입니다. 이 Manager 는 QuerySets 를 반환하며 필터링하고 조작 할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">.</span>entry_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Returns all Entry objects related to Blog.</span>

<span class="token comment"># b.entry_set is a Manager that returns QuerySets.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">.</span>entry_set<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">.</span>entry_set<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>FOO_set에서 ForeignKey의 매개 변수(related_name)를 설정 하여 이름을 대체 할 수 있습니다. 예를 들어, Entry 모델이 &quot;blog = ForeignKey(Blog, on_delete=models.CASCADE, related_name='entries')&quot; 로 변경 되면 위의 예제 코드는 다음과 같이 사용할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Returns all Entry objects related to Blog.</span>

<span class="token comment"># b.entries is a Manager that returns QuerySets.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>headline__contains<span class="token operator">=</span><span class="token string">'Lennon'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">.</span>entries<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="using-a-custom-reverse-manager"><a href="#using-a-custom-reverse-manager" class="header-anchor">#</a> Using a custom reverse manager</h4> <p>기본적으로 역 관계 참조에 사용되는 RelatedManager 는 것은 해당 모델이 갖는 기본 Manager 의 서브 클래스 입니다 . 주어진 쿼리에 다른 Manager를 지정하려면 다음 구문을 사용할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#...</span>
    objects <span class="token operator">=</span> models<span class="token punctuation">.</span>Manager<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Default Manager</span>
    entries <span class="token operator">=</span> EntryManager<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># Custom Manager</span>

b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
b<span class="token punctuation">.</span>entry_set<span class="token punctuation">(</span>manager<span class="token operator">=</span><span class="token string">'entries'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>EntryManager에서 기본 필터링을 수행하면 get_queryset() 메소드에 해당 필터링이 all()호출에 적용됩니다.</p> <p>물론 사용자 정의 리버스 Manager 를 지정하면 해당 사용자 정의 메소드를 호출 할 수도 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>b<span class="token punctuation">.</span>entry_set<span class="token punctuation">(</span>manager<span class="token operator">=</span><span class="token string">'entries'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>is_published<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="additional-methods-to-handle-related-objects"><a href="#additional-methods-to-handle-related-objects" class="header-anchor">#</a> Additional methods to handle related objects</h4> <p>QuerySet은 &quot;개체 검색&quot;에 정의 된 방법 외에도 ForeignKey Manager는 관련 개체 집합을 처리하는 데 사용되는 추가 방법을 제공하고 있습니다. 각각의 개요는 다음과 같으며 자세한 내용은 <a href="https://docs.djangoproject.com/en/3.0/ref/models/relations/" target="_blank" rel="noopener noreferrer">관련 객체 참조<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 에서 찾을 수 있습니다.</p> <p>add(obj1, obj2, ...) :
지정된 모델 객체를 관련 객체 세트에 추가합니다.</p> <p>create(**kwargs) :
새 객체를 만들어 저장하고 관련 객체 세트에 넣습니다. 새로 만든 개체를 반환합니다.</p> <p>remove(obj1, obj2, ...) :
관련 객체 세트에서 지정된 모델 객체를 제거합니다.</p> <p>clear() :
관련 객체 세트에서 모든 객체를 제거합니다.</p> <p>set(objs) :
관련 개체 세트를 교체하십시오.</p> <p>관련 세트의 멤버를 지정하려면 set()에 반복 가능한(iterable) 오브젝트 인스턴스와 함께 메소드를 사용하십시오. 예를 들어, e1 과 e2가 Entry 인스턴스 인 경우 :</p> <div class="language-python extra-class"><pre class="language-python"><code>b <span class="token operator">=</span> Blog<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
b<span class="token punctuation">.</span>entry_set<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>remove(), clear() 는 ForeignKeys 가 null=True 때만 작동됩니다.</p></div> <p>만약 clear() 가 사용 가능하다면 entry_set 의 기존의 객체가 모두 제거한 후에 iterable 객체(이 경우,리스트)를 세트에 추가된다. clear() 가 가능하지 않은 경우 모든 객체는 기존의 요소를 제거하지 않고 추가됩니다.</p> <p>이 섹션에 설명 된 각 &quot;역방향&quot; 작업은 데이터베이스에 즉시 영향을 줍니다. 모든 추가, 작성 및 삭제는 즉시 자동으로 데이터베이스에 저장됩니다.</p> <h3 id="many-to-many-relationships"><a href="#many-to-many-relationships" class="header-anchor">#</a> Many-to-many relationships</h3> <p>다 대 다 관계의 양쪽 끝은 다른 쪽 끝에 자동 API 액세스를 얻습니다. API는 위의 &quot;뒤로&quot;일대 다 관계와 유사하게 작동합니다.</p> <p>한 가지 차이점은 속성 이름 지정에 있습니다. ManyToManyField 필드를 정의하는 모델은 해당 필드 자체의 속성 이름을 사용하지만 &quot;역&quot; 모델은 원래 모델의 소문자 모델 이름과 '_set' 을 합하여 역 일대 다 관계와 동일하게 사용합니다. 예를 들어</p> <div class="language-python extra-class"><pre class="language-python"><code>e <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
e<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Returns all Author objects for this Entry.</span>
e<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
e<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__contains<span class="token operator">=</span><span class="token string">'John'</span><span class="token punctuation">)</span>

a <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>entry_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Returns all Entry objects for this Author.</span>
</code></pre></div><p>ForeignKey와 마찬가지로, ManyToManyField 도 related_name을 지정할 수 있습니다. 위의 예에서 Entry의 ManyToManyField에 related_name='entries' 로 지정된 경우 각 Author 인스턴스는 entry_set 대신 entries 속성을 갖습니다.</p> <p>일대 다 관계와의 또 다른 차이점은  add(), set() 그리고 remove() 메소드에 모델 인스턴스는 뿐만 아니라 기본 키 값도 사용이 가능하다는 것 입니다. 예를 들어 다음의 set() 호출은 동일하게 작동합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>a <span class="token operator">=</span> Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>entry_set<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">]</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>entry_set<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>e1<span class="token punctuation">.</span>pk<span class="token punctuation">,</span> e2<span class="token punctuation">.</span>pk<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="one-to-one-relationships"><a href="#one-to-one-relationships" class="header-anchor">#</a> One-to-one relationships</h3> <p>일대일 관계는 다 대일 관계와 매우 유사합니다. 모델에서 OneToOneField을 정의하면 해당 모델의 인스턴스는 모델의 속성을 통해 관련 객체에 액세스 할 수 있습니다.</p> <p>예를 들면 다음과 같습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">EntryDetail</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    entry <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>Entry<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    details <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>

ed <span class="token operator">=</span> EntryDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
ed<span class="token punctuation">.</span>entry <span class="token comment"># Returns the related Entry object.</span>
</code></pre></div><p>차이점은 &quot;역방향&quot; 쿼리에서 발생합니다. 일대일 관계의 관련 모델도 Manager 객체에 액세스 할 수 있지만 Manager 객체 모음이 아닌 단일 객체 를 나타냅니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>e <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
e<span class="token punctuation">.</span>entrydetail <span class="token comment"># returns the related EntryDetail object</span>
</code></pre></div><p>이 관계에 객체가 할당되어 있지 않으면 Django는 DoesNotExist예외를 발생시킵니다.
순방향 관계를 지정할 때와 같은 방법으로 인스턴스를 역관계에 지정할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>e<span class="token punctuation">.</span>entrydetail <span class="token operator">=</span> ed
</code></pre></div><h3 id="how-are-the-backward-relationships-possible"><a href="#how-are-the-backward-relationships-possible" class="header-anchor">#</a> How are the backward relationships possible?</h3> <p>다른 객체 관계형 매퍼는 양쪽에 관계를 정의해야합니다. Django 개발자는 이것이 DRY (Do n't Repeat Yourself) 원칙을 위반한다고 생각하므로 Django는 한쪽 끝의 관계 만 정의하면 됩니다.</p> <p>그러나 모델 클래스가 다른 모델 클래스가 로드 될 때까지 어떤 모델 클래스가 관련되어 있는지 알지 못한다면 어떻게 이것이 가능합니까?</p> <p>대답은 app registry에 있습니다. Django가 시작되면 INSTALLED_APPS에 나열된 각 응용 프로그램을 가져온 다음 각 응용 프로그램 내부 models의 모듈을 가져옵니다. 새로운 모델 클래스가 생성 될 때마다 Django는 관련 모델에 역관계를 추가합니다. 관련 모델을 아직 import 하지 않은 경우 Django는 관계를 추적하고 관련 모델을 import 할 때 관계를 추가합니다.</p> <p>이러한 이유로 사용중인 모든 모델을 INSTALLED_APPS에 응용 프로그램으로 정의해야 합니다. 그렇지 않으면 역방향 관계가 제대로 작동하지 않을 수 있습니다.</p> <h3 id="queries-over-related-objects"><a href="#queries-over-related-objects" class="header-anchor">#</a> Queries over related objects</h3> <p>관련 개체와 관련된 쿼리는 일반 값 필드의 쿼리와 동일한 규칙을 따릅니다. 일치하는 쿼리 값을 지정할 때 객체 인스턴스 자체 또는 객체의 기본 키 값을 사용할 수 있습니다.</p> <p>다음과 같은 세 가지 쿼리는 동일 할 것이다 :</p> <div class="language-python extra-class"><pre class="language-python"><code>Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog<span class="token operator">=</span>b<span class="token punctuation">)</span> <span class="token comment"># Query using object instance</span>
Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog<span class="token operator">=</span>b<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token comment"># Query using id from instance</span>
Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>blog<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment"># Query using id directly</span>
</code></pre></div><h2 id="falling-back-to-raw-sql"><a href="#falling-back-to-raw-sql" class="header-anchor">#</a> Falling back to raw SQL</h2> <p>Django의 데이터베이스 맵퍼가 처리하기에 너무 복잡한 SQL 쿼리를 작성해야하는 경우 수동으로 SQL을 작성할 수 있습니다. Django에는 원시 SQL 쿼리를 작성하기 위한 몇 가지 옵션이 있습니다. <a href="https://docs.djangoproject.com/en/3.0/topics/db/sql/" target="_blank" rel="noopener noreferrer">원시 SQL 쿼리<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 수행을 참조하십시오 .</p> <p>마지막으로 Django 데이터베이스 계층은 데이터베이스에 대한 인터페이스 일뿐입니다. 다른 도구, 프로그래밍 언어 또는 데이터베이스 프레임 워크를 통해 데이터베이스에 액세스 할 수 있습니다. 데이터베이스에 대해 Django 고유의 것은 없습니다.</p> <h2 id="filter-a-filter-b-vs-filter-a-b"><a href="#filter-a-filter-b-vs-filter-a-b" class="header-anchor">#</a> filter(A).filter(B) vs filter(A, B)</h2> <h2 id="select-related-and-prefetch-related"><a href="#select-related-and-prefetch-related" class="header-anchor">#</a> select_related and prefetch_related</h2> <h2 id="how-to-join-3-tables-in-query-with-djang"><a href="#how-to-join-3-tables-in-query-with-djang" class="header-anchor">#</a> How to join 3 tables in query with Djang</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># models.py</span>
<span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    emp_no <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    first_name <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    last_name <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment"># emp_no first_name  last_name</span>
      <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
      <span class="token number">10005</span>  Christian   Erde

<span class="token keyword">class</span> <span class="token class-name">DeptEmp</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    emp_no <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Employee<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    dept_no <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Department<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>

    <span class="token comment"># dept_no_id  emp_no_id</span>
      <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
      d003        <span class="token number">10005</span>

<span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dept_no <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    dept_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>

    <span class="token comment">#  dept_no     dept_name</span>
       <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
       d003        Human Resources

<span class="token comment"># views.py</span>
<span class="token keyword">class</span> <span class="token class-name">EmpList</span><span class="token punctuation">(</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> DeptEmp<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'emp_no'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'dept_no'</span><span class="token punctuation">)</span>

<span class="token comment"># template.html</span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> deptemp <span class="token keyword">in</span> object_list <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> deptemp<span class="token punctuation">.</span>emp_no<span class="token punctuation">.</span>first_name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> deptemp<span class="token punctuation">.</span>emp_no<span class="token punctuation">.</span>last_name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> deptemp<span class="token punctuation">.</span>dept_no<span class="token punctuation">.</span>dept_name <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="annotate-aggregation-and-subquery"><a href="#annotate-aggregation-and-subquery" class="header-anchor">#</a> annotate, aggregation and subquery</h2> <h2 id="resources"><a href="#resources" class="header-anchor">#</a> Resources</h2> <p><a href="https://docs.djangoproject.com/en/3.0/topics/db/queries/" target="_blank" rel="noopener noreferrer">Making queries<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://docs.djangoproject.com/en/3.0/ref/models/querysets/" target="_blank" rel="noopener noreferrer">Queryset API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://hacksoft.io/django-filter-chaining/" target="_blank" rel="noopener noreferrer">filter(A).filter(B) vs filter(A, B)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://stackoverflow.com/questions/43772163/how-to-join-3-tables-in-query-with-django" target="_blank" rel="noopener noreferrer">How to join 3 tables in query with Django<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://medium.com/better-programming/django-select-related-and-prefetch-related-f23043fd635d" target="_blank" rel="noopener noreferrer">Django select_related and prefetch_related<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://medium.com/@chrisjune_13837/django-5-orm-queries-you-should-know-a0f4533b31e8" target="_blank" rel="noopener noreferrer">5 ORM queries you should know!<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://medium.com/@jairvercosa/manger-vs-query-sets-in-django-e9af7ed744e0" target="_blank" rel="noopener noreferrer">Manager vs Query Sets in Django<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frameworks/django/model.html" class="prev">
        Model 1
      </a></span> <span class="next"><a href="/frameworks/django/queryset.html">
        QuerySet API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.226a413b.js" defer></script><script src="/assets/js/2.73abacf5.js" defer></script><script src="/assets/js/25.4f4cd96f.js" defer></script>
  </body>
</html>
