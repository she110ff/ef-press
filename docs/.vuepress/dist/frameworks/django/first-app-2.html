<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>First App - 2.Models and the admin site | Knowledge Share</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.3cf712f1.css" as="style"><link rel="preload" href="/assets/js/app.46a52470.js" as="script"><link rel="preload" href="/assets/js/2.73abacf5.js" as="script"><link rel="preload" href="/assets/js/18.7d163443.js" as="script"><link rel="prefetch" href="/assets/js/10.351a57cb.js"><link rel="prefetch" href="/assets/js/11.6393c270.js"><link rel="prefetch" href="/assets/js/12.258ce84f.js"><link rel="prefetch" href="/assets/js/13.56874ee8.js"><link rel="prefetch" href="/assets/js/14.37295ec6.js"><link rel="prefetch" href="/assets/js/15.d3ebe5dd.js"><link rel="prefetch" href="/assets/js/16.f2f87609.js"><link rel="prefetch" href="/assets/js/17.bbd8a445.js"><link rel="prefetch" href="/assets/js/19.19b5b7f6.js"><link rel="prefetch" href="/assets/js/20.829e3d87.js"><link rel="prefetch" href="/assets/js/21.f1db19aa.js"><link rel="prefetch" href="/assets/js/22.b0ae292b.js"><link rel="prefetch" href="/assets/js/23.62f19473.js"><link rel="prefetch" href="/assets/js/24.99acb3cb.js"><link rel="prefetch" href="/assets/js/25.910f9f6d.js"><link rel="prefetch" href="/assets/js/26.46561b4a.js"><link rel="prefetch" href="/assets/js/27.43efdd05.js"><link rel="prefetch" href="/assets/js/28.b34493f3.js"><link rel="prefetch" href="/assets/js/29.913d2330.js"><link rel="prefetch" href="/assets/js/3.0119ca6e.js"><link rel="prefetch" href="/assets/js/30.876cd1ae.js"><link rel="prefetch" href="/assets/js/31.eb5641ed.js"><link rel="prefetch" href="/assets/js/32.2c33ae94.js"><link rel="prefetch" href="/assets/js/33.0fd28b80.js"><link rel="prefetch" href="/assets/js/34.482bd009.js"><link rel="prefetch" href="/assets/js/35.77e80232.js"><link rel="prefetch" href="/assets/js/36.6154cdc8.js"><link rel="prefetch" href="/assets/js/37.ad4220f1.js"><link rel="prefetch" href="/assets/js/38.db259bfc.js"><link rel="prefetch" href="/assets/js/39.95fed648.js"><link rel="prefetch" href="/assets/js/4.18b7f171.js"><link rel="prefetch" href="/assets/js/40.0fdc22f3.js"><link rel="prefetch" href="/assets/js/41.ac95b8b8.js"><link rel="prefetch" href="/assets/js/42.b226d007.js"><link rel="prefetch" href="/assets/js/43.4022eb0b.js"><link rel="prefetch" href="/assets/js/44.24df495c.js"><link rel="prefetch" href="/assets/js/45.934df6e3.js"><link rel="prefetch" href="/assets/js/46.3c84a5bb.js"><link rel="prefetch" href="/assets/js/47.fe62c0b5.js"><link rel="prefetch" href="/assets/js/48.6158f309.js"><link rel="prefetch" href="/assets/js/49.10d00fb9.js"><link rel="prefetch" href="/assets/js/5.96509959.js"><link rel="prefetch" href="/assets/js/50.5a76b24b.js"><link rel="prefetch" href="/assets/js/51.e5626470.js"><link rel="prefetch" href="/assets/js/52.9ab31a32.js"><link rel="prefetch" href="/assets/js/53.0344e8e6.js"><link rel="prefetch" href="/assets/js/54.051230fc.js"><link rel="prefetch" href="/assets/js/55.0d6d875f.js"><link rel="prefetch" href="/assets/js/56.cb2d6ed4.js"><link rel="prefetch" href="/assets/js/57.e46f3cc2.js"><link rel="prefetch" href="/assets/js/58.a1265c97.js"><link rel="prefetch" href="/assets/js/59.e43d9167.js"><link rel="prefetch" href="/assets/js/6.eafd2c6f.js"><link rel="prefetch" href="/assets/js/60.f6b21a78.js"><link rel="prefetch" href="/assets/js/61.4a860e23.js"><link rel="prefetch" href="/assets/js/62.6ce4d451.js"><link rel="prefetch" href="/assets/js/63.8c36f6c5.js"><link rel="prefetch" href="/assets/js/64.01d48950.js"><link rel="prefetch" href="/assets/js/65.2429ca61.js"><link rel="prefetch" href="/assets/js/66.d47955f7.js"><link rel="prefetch" href="/assets/js/67.49ce7e31.js"><link rel="prefetch" href="/assets/js/68.c7cf9e03.js"><link rel="prefetch" href="/assets/js/69.a063450a.js"><link rel="prefetch" href="/assets/js/7.219c88d1.js"><link rel="prefetch" href="/assets/js/70.026d7c8c.js"><link rel="prefetch" href="/assets/js/71.23fea48d.js"><link rel="prefetch" href="/assets/js/72.66e45e3c.js"><link rel="prefetch" href="/assets/js/73.fd7cba88.js"><link rel="prefetch" href="/assets/js/74.2b525f65.js"><link rel="prefetch" href="/assets/js/75.fa84901e.js"><link rel="prefetch" href="/assets/js/76.a8d34081.js"><link rel="prefetch" href="/assets/js/77.3cc197c2.js"><link rel="prefetch" href="/assets/js/78.38e4043b.js"><link rel="prefetch" href="/assets/js/79.9491cbf2.js"><link rel="prefetch" href="/assets/js/8.a995c8bd.js"><link rel="prefetch" href="/assets/js/80.8df9a4a8.js"><link rel="prefetch" href="/assets/js/81.ea47d9c5.js"><link rel="prefetch" href="/assets/js/82.352235af.js"><link rel="prefetch" href="/assets/js/83.e0a3b10f.js"><link rel="prefetch" href="/assets/js/84.165fae16.js"><link rel="prefetch" href="/assets/js/85.54b07ddb.js"><link rel="prefetch" href="/assets/js/86.ad0be71f.js"><link rel="prefetch" href="/assets/js/87.529106b5.js"><link rel="prefetch" href="/assets/js/88.1213684e.js"><link rel="prefetch" href="/assets/js/89.c28404c1.js"><link rel="prefetch" href="/assets/js/9.f853c54c.js"><link rel="prefetch" href="/assets/js/90.03bd6d38.js"><link rel="prefetch" href="/assets/js/91.a008fe76.js"><link rel="prefetch" href="/assets/js/92.689e6d1f.js"><link rel="prefetch" href="/assets/js/93.6e7326b6.js"><link rel="prefetch" href="/assets/js/94.50198b6c.js"><link rel="prefetch" href="/assets/js/95.95b09757.js"><link rel="prefetch" href="/assets/js/96.588d599f.js"><link rel="prefetch" href="/assets/js/97.21b640fd.js"><link rel="prefetch" href="/assets/js/98.bd06af5f.js"><link rel="prefetch" href="/assets/js/99.8d1cc7e9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3cf712f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Knowledge Share</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frameworks/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/vuejs/" class="nav-link">
  VueJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/django/" class="nav-link router-link-active">
  Django
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nuxtjs/" class="nav-link">
  NuxtJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nestjs/" class="nav-link">
  NestJS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool &amp; Module" class="dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tool &amp; Module" class="mobile-dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool-module/django-rest/" class="nav-link">
  Django-REST
</a></li><li class="dropdown-item"><!----> <a href="/tool-module/clean-arch/" class="nav-link">
  Clean Architecture
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Workflow" class="dropdown-title"><span class="title">Workflow</span> <span class="arrow down"></span></button> <button type="button" aria-label="Workflow" class="mobile-dropdown-title"><span class="title">Workflow</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workflow/nuxtjs-django/" class="nav-link">
  NuxtJS-Django
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/languages/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frameworks/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/vuejs/" class="nav-link">
  VueJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/django/" class="nav-link router-link-active">
  Django
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nuxtjs/" class="nav-link">
  NuxtJS
</a></li><li class="dropdown-item"><!----> <a href="/frameworks/nestjs/" class="nav-link">
  NestJS
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool &amp; Module" class="dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tool &amp; Module" class="mobile-dropdown-title"><span class="title">Tool &amp; Module</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool-module/django-rest/" class="nav-link">
  Django-REST
</a></li><li class="dropdown-item"><!----> <a href="/tool-module/clean-arch/" class="nav-link">
  Clean Architecture
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Workflow" class="dropdown-title"><span class="title">Workflow</span> <span class="arrow down"></span></button> <button type="button" aria-label="Workflow" class="mobile-dropdown-title"><span class="title">Workflow</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/workflow/nuxtjs-django/" class="nav-link">
  NuxtJS-Django
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Django</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frameworks/django/" aria-current="page" class="sidebar-link">Why Django</a></li><li><a href="/frameworks/django/overview.html" class="sidebar-link">살펴 보기</a></li><li><a href="/frameworks/django/django-install.html" class="sidebar-link">설치 &amp; 프로젝트 생성</a></li><li><a href="/frameworks/django/django-database.html" class="sidebar-link">Database 설치</a></li><li><a href="/frameworks/django/first-app-1.html" class="sidebar-link">First App - 1.Requests and responses</a></li><li><a href="/frameworks/django/first-app-2.html" aria-current="page" class="active sidebar-link">First App - 2.Models and the admin site</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frameworks/django/first-app-2.html#데이터베이스-setup" class="sidebar-link">데이터베이스 Setup</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/first-app-2.html#postgresql-설치하기" class="sidebar-link">PostgreSQL 설치하기</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/first-app-2.html#모델-생성" class="sidebar-link">모델 생성</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/first-app-2.html#데이터베이스-api" class="sidebar-link">데이터베이스 API</a></li><li class="sidebar-sub-header"><a href="/frameworks/django/first-app-2.html#django-admin" class="sidebar-link">Django Admin</a></li></ul></li><li><a href="/frameworks/django/model.html" class="sidebar-link">Model 1</a></li><li><a href="/frameworks/django/how-to-query.html" class="sidebar-link">쿼리 만들기</a></li><li><a href="/frameworks/django/queryset.html" class="sidebar-link">QuerySet API</a></li><li><a href="/frameworks/django/lookup.html" class="sidebar-link">Lookup</a></li><li><a href="/frameworks/django/first-app-3.html" class="sidebar-link">First App - 3.Views and templates</a></li><li><a href="/frameworks/django/first-app-4.html" class="sidebar-link">First App - 4.Forms and generic views</a></li><li><a href="/frameworks/django/first-app-5.html" class="sidebar-link">First App - 5.Testing</a></li><li><a href="/frameworks/django/first-app-6.html" class="sidebar-link">First App - 6.Static files</a></li><li><a href="/frameworks/django/first-app-7.html" class="sidebar-link">First App - 7.Customizing the admin site</a></li><li><a href="/frameworks/django/tests.html" class="sidebar-link">Django Testing Cheat Sheet</a></li><li><a href="/frameworks/django/url-dispatcher.html" class="sidebar-link">URL dispatcher</a></li><li><a href="/frameworks/django/errors.html" class="sidebar-link">Error</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="first-app-2-models-and-the-admin-site"><a href="#first-app-2-models-and-the-admin-site" class="header-anchor">#</a> First App - 2.Models and the admin site</h1> <p>Fist App - 1.Requests and responses 에 이어지는 설명입니다.</p> <p>학습 목표</p> <ol><li>데이터베이스 Setup</li> <li>모델 작성</li> <li>마이그레이션과 롤백</li> <li>어드민 사이트 이해</li></ol> <h2 id="데이터베이스-setup"><a href="#데이터베이스-setup" class="header-anchor">#</a> 데이터베이스 Setup</h2> <p>site_name/settings.py 파일을 보시면, 일반적인 파이썬 모듈 수준의 변수를 통해서 Django 설정을 하고 있는 것을 볼 수 있습니다.
</p><p>
TIME_ZONE 에는 데이터베이스에서 사용할 사용자의 time zone을 입력합니다. <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener noreferrer">Time Zone List<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>INSTALLED_APPS 는 활성화 Django 애플리케이션의 목록입니다. 기본적으로 다음과 App이 포함되어 있습니다.</p> <ul><li>django.contrib.admin – 어드민 사이트</li> <li>django.contrib.auth – 인증 시스템</li> <li>django.contrib.contenttypes – 컨텐츠 타입 프레임워크</li> <li>django.contrib.sessions – 세션 프레임워크.</li> <li>django.contrib.messages – 메세징 프레임워크.</li> <li>django.contrib.staticfiles – static 파일 관리</li></ul> <p>해당 App을 사용하기 전에 마이그레이션을 해야 합니다.</p> <p>django 프로젝트를 처음 생성하면 아래와 같이 sqlite를 기반으로 데이터베이스 설정이 작성되어 있습니다. 이 설정을 사용하여 쉽게 django 프로젝트를 시작할 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.sqlite3'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'db.sqlite3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ENGINE : sqlite3, postgresql, mysql, oracle 과 3th party cockroachDB, Firebird, MS-SQL 을 사용할 수 있습니다.</li> <li>NAME : sqlite를 사용한다면 파일의 전체 경로, 다른 데이터베이스라면 DB 이름 입니다.</li></ul> <h2 id="postgresql-설치하기"><a href="#postgresql-설치하기" class="header-anchor">#</a> PostgreSQL 설치하기</h2> <p>설치 파일을 다운로드 받습니다.
<a href="https://www.enterprisedb.com/downloads/postgres-postgresql-downloads" target="_blank" rel="noopener noreferrer">PostgreSQL Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="설치-진행-약-5-10분"><a href="#설치-진행-약-5-10분" class="header-anchor">#</a> 설치 진행 (약 5~10분)</h3> <ol><li>파일을 다운로드한 후에 더블클릭하여 설치를 시작합니다.</li> <li>PostgreSQL Server, pgAdmin 4, Stack Builder, Command Line Tool 을 선택해서 설치할 수 있습니다.</li> <li>설치를 진행하면 데이터베이스 슈퍼유저(postgres)의 패스워드를 입력하고 지역을 선택합니다. 포트는 5432로 유지합니다.</li> <li>설치가 종료되면 pgAdmin 또는 SQL Shell을 실행합니다.</li></ol> <h3 id="command-line-tool"><a href="#command-line-tool" class="header-anchor">#</a> Command Line Tool</h3> <p>Command line tool 에 SQL Shell 을 입력하고 창을 열면 Server, Database, Port, Usename, Password 를 입력하여 psql 쉘에 접속이 가능합니다.</p> <h3 id="database-만들기"><a href="#database-만들기" class="header-anchor">#</a> database 만들기</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># connect server as user </span>
<span class="token operator">&gt;</span> psql -U postgres

<span class="token comment"># create user</span>
<span class="token operator">&gt;</span> CREATE <span class="token environment constant">USER</span> tms_user WITH PASSWORD <span class="token string">'tms_pass'</span><span class="token punctuation">;</span>

<span class="token comment"># create db</span>
<span class="token operator">&gt;</span> CREATE DATABASE tms_local WITH OWNER tms_user<span class="token punctuation">;</span>

<span class="token comment"># create grant</span>
<span class="token operator">&gt;</span> GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO tms_user<span class="token punctuation">;</span>

<span class="token comment"># connect db</span>
<span class="token operator">&gt;</span> <span class="token punctuation">\</span>c tms_local

python manage.py migrate 이후에 

<span class="token comment"># show table list</span>
<span class="token operator">&gt;</span> <span class="token punctuation">\</span>dt

                   List of relations
 Schema <span class="token operator">|</span>            Name            <span class="token operator">|</span> Type  <span class="token operator">|</span>  Owner
--------+----------------------------+-------+----------
 public <span class="token operator">|</span> auth_group                 <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> auth_group_permissions     <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> auth_permission            <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> auth_user                  <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> auth_user_groups           <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> auth_user_user_permissions <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> blog_author                <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> blog_blog                  <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> blog_entry                 <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> blog_entry_authors         <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> django_admin_log           <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> django_content_type        <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> django_migrations          <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> django_session             <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> polls_choice               <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
 public <span class="token operator">|</span> polls_question             <span class="token operator">|</span> table <span class="token operator">|</span> tms_user
<span class="token punctuation">(</span><span class="token number">16</span> rows<span class="token punctuation">)</span>
</code></pre></div><h3 id="db-세팅하기"><a href="#db-세팅하기" class="header-anchor">#</a> DB 세팅하기</h3> <p>엔진, DB Name 등을 설정합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.postgresql'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'tms_local'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'tms_user'</span><span class="token punctuation">,</span>
        <span class="token string">'PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">'tms_pass'</span><span class="token punctuation">,</span>
        <span class="token string">'HOST'</span><span class="token punctuation">:</span> <span class="token string">'db'</span><span class="token punctuation">,</span>
        <span class="token string">'PORT'</span><span class="token punctuation">:</span> <span class="token string">'5432'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="마이그레이션"><a href="#마이그레이션" class="header-anchor">#</a> 마이그레이션</h3> <p>django 패키지에 포함된 모델을 마이그레이션 합니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>myvenv<span class="token punctuation">)</span> $ python manage.py makemigrations
<span class="token punctuation">(</span>myvenv<span class="token punctuation">)</span> $ python manage.py migrate
</code></pre></div><h2 id="모델-생성"><a href="#모델-생성" class="header-anchor">#</a> 모델 생성</h2> <p>본질적으로, 모델이란 부가적인 메타데이터를 가진 데이터베이스의 구조(layout)를 말합니다.
</p><p>
다음에서 Question, Choice 두 개의 모델을 만들고 각 Choice 는 Question의 연결이 됩니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># polls/models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token string">'date published'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Choice</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    choice_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    votes <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>사용자 모델은 django.db.model.Model 의 서브클래스 입니다. 각 모델의 클래스 변수는 데이터베이스 필드를 표현합니다.</p> <ul><li>각 필드는 django.db.models.Field( <a href="https://docs.djangoproject.com/en/3.0/ref/models/fields/#field-types" target="_blank" rel="noopener noreferrer">Field Types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) 의 인스턴스 입니다.</li> <li>필드 인스턴스의 이름 (e.g. question_text or pub_date) 은 데이터베이스 컬럼 이름으로 사용됩니다.</li> <li>선택적으로 필드의 첫 인자에 human-readable 값을 사용할 수 있습니다. ForeignKey, ManyToManyField and OneToOneField 는 verbose_name 을 사용해야 합니다.</li> <li>필드의 타입에 따라서 필수 인자를 요구합니다. CharField 의 경우 max_length 가 그러한 예 입니다.</li> <li>default=0 의 예와 같이, 필드는 여러 선택적 인자를 추가할 수 있습니다.</li> <li>Django 는 일반적인 관계형 데이터베이스의 Entity 관계(one-to-one, many-to-one, many-to-many )를 제공합니다.</li></ul> <h3 id="모델-활성화"><a href="#모델-활성화" class="header-anchor">#</a> 모델 활성화</h3> <p>모델은 적은 코드로 Django에 여러 정보를 제공하고 Django는 다음을 수행할 수 있습니다.</p> <ul><li>App 을 위한 데이터베이스 스키마를 작성할 수 있습니다.</li> <li>파이썬 데이터베이스 API 를 만들어 모델 객체에서 접근할 수 있게 만듭니다.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Django App 은 'pluggable' 하다고 표현합니다. 여러 프로젝트에 사용할 수 있고 배포할 수 있다는 것을 의미합니다.</p></div> <p>모델을 작성한 후에는 INSTALLED_APPS 에 참조를 설정합니다. polls/apps.py 파일의 PollsConifig 의 package path는 polls.apps.PollsConfig 입니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># mysite/settings.py</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'polls.apps.PollsConfig'</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
</code></pre></div><p>polls App 을 위한 마이레이션 파일을 생성합니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py makemigrations polls
</code></pre></div><p>정상적으로 수행이 끝나면 다음과 같은 결과를 볼 수 있습니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Migrations <span class="token keyword">for</span> <span class="token string">'polls'</span><span class="token builtin class-name">:</span>
  polls/migrations/0001_initial.py
    - Create model Question
    - Create model Choice
</code></pre></div><p>마이그레이션은 Django 에서 모델과 데이터베이스가 어떻게 변경이 있는지를 보여주고 실행하게 됩니다.
</p><p></p> <h3 id="마이그레이션-sql-보기"><a href="#마이그레이션-sql-보기" class="header-anchor">#</a> 마이그레이션 SQL 보기</h3> <p>sqlmigrate 명령어는 App, 마이그레이션 이름을 얻어서 해당 마이그레이션이 수행항 sql statement 를 보여줍니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py sqlmigrate polls 0001
</code></pre></div><p>다음과 유사한 결과를 볼 수 있습니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#sqlite</span>
BEGIN<span class="token punctuation">;</span>
--
-- Create model Question
--
CREATE TABLE <span class="token string">&quot;polls_question&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> integer NOT NULL PRIMARY KEY AUTOINCREMENT, 
                                <span class="token string">&quot;question_text&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> NOT NULL, 
                                <span class="token string">&quot;pub_date&quot;</span> datetime NOT NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
--
-- Create model Choice
--
CREATE TABLE <span class="token string">&quot;polls_choice&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span> integer NOT NULL PRIMARY KEY AUTOINCREMENT, 
                                <span class="token string">&quot;choice_text&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> NOT NULL, 
                                <span class="token string">&quot;votes&quot;</span> integer NOT NULL, 
                                <span class="token string">&quot;question_id&quot;</span> integer NOT NULL REFERENCES 
                                <span class="token string">&quot;polls_question&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> 
                                DEFERRABLE INITIALLY DEFERRED<span class="token punctuation">)</span><span class="token punctuation">;</span>
CREATE INDEX <span class="token string">&quot;polls_choice_question_id_c5b4b260&quot;</span> ON <span class="token string">&quot;polls_choice&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;question_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
COMMIT<span class="token punctuation">;</span>

<span class="token comment"># psql</span>
BEGIN<span class="token punctuation">;</span>
--
-- Create model Question
--
CREATE TABLE <span class="token string">&quot;polls_question&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> serial NOT NULL PRIMARY KEY,
    <span class="token string">&quot;question_text&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> NOT NULL,
    <span class="token string">&quot;pub_date&quot;</span> timestamp with <span class="token function">time</span> zone NOT NULL
<span class="token punctuation">)</span><span class="token punctuation">;</span>
--
-- Create model Choice
--
CREATE TABLE <span class="token string">&quot;polls_choice&quot;</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;id&quot;</span> serial NOT NULL PRIMARY KEY,
    <span class="token string">&quot;choice_text&quot;</span> varchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> NOT NULL,
    <span class="token string">&quot;votes&quot;</span> integer NOT NULL,
    <span class="token string">&quot;question_id&quot;</span> integer NOT NULL
<span class="token punctuation">)</span><span class="token punctuation">;</span>
ALTER TABLE <span class="token string">&quot;polls_choice&quot;</span>
  ADD CONSTRAINT <span class="token string">&quot;polls_choice_question_id_c5b4b260_fk_polls_question_id&quot;</span>
    FOREIGN KEY <span class="token punctuation">(</span><span class="token string">&quot;question_id&quot;</span><span class="token punctuation">)</span>
    REFERENCES <span class="token string">&quot;polls_question&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
    DEFERRABLE INITIALLY DEFERRED<span class="token punctuation">;</span>
CREATE INDEX <span class="token string">&quot;polls_choice_question_id_c5b4b260&quot;</span> ON <span class="token string">&quot;polls_choice&quot;</span> <span class="token punctuation">(</span><span class="token string">&quot;question_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

COMMIT<span class="token punctuation">;</span>
</code></pre></div><ul><li>실제 결과는 데이터베이스에 따라 상이 합니다.</li> <li>테이블명은 App과 모델의 이름을 조합한 소문자로 자동 작성이 됩니다.</li> <li>Primary Key(id) 는 자동으로 추가됩니다.</li> <li>Foreign key 에 _id 를 자동으로 추가합니다.</li> <li>데이터베이스에 따라 기술도는 필드 타입들이 존재합니다. 예를 들어 id 필드의 경우 auto_increment (MySQL), serial (PostgreSQL), integer primary key autoincrement (SQLite) 로 Django 에서 자동 생성이 됩니다.</li></ul> <p></p><p>migrate 명령어를 실행하여 polls의 테이블을 생성합니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py migrate polls
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, polls, sessions
Running migrations:
  Applying polls.0001_initial<span class="token punctuation">..</span>. OK
</code></pre></div><h3 id="필드-삭제-마이그레이션"><a href="#필드-삭제-마이그레이션" class="header-anchor">#</a> 필드 삭제 마이그레이션</h3> <p>pub_date 필드를 삭제한다면,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
</code></pre></div><p>다음과 같은 프롬프트를 볼 수 있습니다. 1)</p> <div class="language-bash extra-class"><pre class="language-bash"><code>Migrations <span class="token keyword">for</span> <span class="token string">'polls'</span><span class="token builtin class-name">:</span>
  polls/migrations/0002_remove_question_pub_date.py
    - Remove field pub_date from question
</code></pre></div><p>현재 마이그레이션 상태를 보고, 실행합니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py showmigrations polls
polls
 <span class="token punctuation">[</span>X<span class="token punctuation">]</span> 0001_initial
 <span class="token punctuation">[</span> <span class="token punctuation">]</span> 0002_remove_question_pub_date

python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, polls, sessions
Running migrations:
  Applying polls.0002_remove_question_pub_date<span class="token punctuation">..</span>. OK
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>MySQL은 Rollback이 불가능하면 테이블을 새로 작성해야 합니다.
<a href="https://docs.djangoproject.com/en/3.0/topics/migrations/" target="_blank" rel="noopener noreferrer">Django Migration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>check 명령은 마이그레이션과 관련되어 문제를 일으키는 이슈가 있는지 확인 할 수 있습니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py check
System check identified no issues <span class="token punctuation">(</span><span class="token number">0</span> silenced<span class="token punctuation">)</span>.
</code></pre></div><h3 id="이전-마이그레이션으로-rollback"><a href="#이전-마이그레이션으로-rollback" class="header-anchor">#</a> 이전 마이그레이션으로 Rollback</h3> <p>0001 버전으로 Rollback 하고 싶다면,</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py migrate polls 0001
Operations to perform:
  Target specific migration: 0001_initial, from polls
Running migrations:
  Rendering model states<span class="token punctuation">..</span>. DONE
  Unapplying polls.0002_remove_question_pub_date<span class="token punctuation">..</span>. OK

<span class="token function">rm</span> ./polls/migrations/0002_remove_question_pub_date.py
</code></pre></div><p>Unapplying 후에 polls/migrations/0002_remove_question_pub_date.py 을 디렉토리에서 삭제합니다.</p> <h3 id="필드-추가-마이그레이션"><a href="#필드-추가-마이그레이션" class="header-anchor">#</a> 필드 추가 마이그레이션</h3> <p>end_date 필드를 추가한다면,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token string">'date published'</span><span class="token punctuation">)</span>
    end_date <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token string">'date ended'</span><span class="token punctuation">)</span>
</code></pre></div><p>다음과 같은 프롬프트를 볼 수 있습니다. 모델의 변경 상태에 따라 나오는 가이드에 따라 수행하거나 Quit 을 선택하여 모델을 수정합니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>You are trying to <span class="token function">add</span> a non-nullable field <span class="token string">'end_date'</span> to question without a default<span class="token punctuation">;</span> we can<span class="token string">'t do that (the database needs something to populate existing rows).
Please select a fix:
 1) Provide a one-off default now (will be set on all existing rows with a null value for this column)
 2) Quit, and let me add a default in models.py


Select an option: 1
Please enter the default value now, as valid Python
The datetime and django.utils.timezone modules are available, so you can do e.g. timezone.now
Type '</span><span class="token builtin class-name">exit</span><span class="token string">' to exit this prompt
&gt;&gt;&gt; timezone.now
Migrations for '</span>polls':
  polls/migrations/0002_question_end_date.py
    - Add field end_date to question 

python manage.py migrate polls
Operations to perform:
  Apply all migrations: polls
Running migrations:
  Applying polls.0002_question_end_date<span class="token punctuation">..</span>. OK

</code></pre></div><h3 id="sqlite-다운로드"><a href="#sqlite-다운로드" class="header-anchor">#</a> SQLite 다운로드</h3> <p><a href="https://download.sqlitebrowser.org/DB.Browser.for.SQLite-3.12.0-win64.msi" target="_blank" rel="noopener noreferrer">DB Browser for SQLite - Standard installer for 64-bit Windows<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>다음은 프로젝트를 생성한 후 최초 migrate 명령을 수행한 결과입니다.(sqlite)
</p><figure><img src="/initial_django_sqlite_migrations.png"></figure><p></p> <h3 id="마이그레이션-초기화"><a href="#마이그레이션-초기화" class="header-anchor">#</a> 마이그레이션 초기화</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py migrate my_app zero
</code></pre></div><p>마이그레이션은 매우 파워풀한 기능입니다. 테이블을 다시 만들거나 하지 않고도 모델이 변경될 때마다  3단계를 따라 실행할 수 있습니다.</p> <ol><li>모델을 변경합니다.(in models.py)</li> <li>makemigrations 명령을 실행하여 파일을 생성 합니다.</li> <li>migrate 명령을 싫행하여 데이터베이스에 변경사항을 적용합니다.</li></ol> <p>개발 상의 번거로움이 있음에도 마이그레이션 명령이 두 개(makemigrations, migrate) 으로 나누어진 이유는 버전 컨트롤 시스템에 마이그레이션 파일을 커밋하는 것을 돕기 위해서 입니다.</p> <h2 id="데이터베이스-api"><a href="#데이터베이스-api" class="header-anchor">#</a> 데이터베이스 API</h2> <p>파이썬 interactive shell 을 통해 모델 객체의 API를 작동해 보겠습니다.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py shell
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> polls<span class="token punctuation">.</span>models <span class="token keyword">import</span> Choice<span class="token punctuation">,</span> Question  <span class="token comment"># App 수준에서 모듈을 임포트합니다. </span>

<span class="token comment"># 아직 등록된 question 이 없습나다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

<span class="token comment"># 새로운 Question을 생성합니다.</span>
<span class="token comment"># Django 에서 tzinfo 를 포함한 pub_date를 필요로 하기 때문에 datetime.datetime.now() 대시 timezone.now() 를 사용합니다. </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>utils <span class="token keyword">import</span> timezone
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> Question<span class="token punctuation">(</span>question_text<span class="token operator">=</span><span class="token string">&quot;What's new?&quot;</span><span class="token punctuation">,</span> pub_date<span class="token operator">=</span>timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># save() 를 호출하여 데이터베이스에 저장합니다. .</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 레코드는 자동 생성된 ID를 가지고 있습니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span><span class="token builtin">id</span>
<span class="token number">1</span>

<span class="token comment"># 파이썬 속성을 통해 필드에 접근할 수 있습니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>question_text
<span class="token string">&quot;What's new?&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>pub_date
datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">775217</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span><span class="token operator">&lt;</span>UTC<span class="token operator">&gt;</span><span class="token punctuation">)</span>

<span class="token comment"># 속성을 통해 값을 변경한 후에 save()를 호출하여 저장합니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>question_text <span class="token operator">=</span> <span class="token string">&quot;What's up?&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># objects.all() 은 데이터베이스에 있는 모든 question 레코드를 보여줍니다. </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> Question <span class="token builtin">object</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>object를 조회할 때 '&lt;Question: Question object (1)&gt;'와 같은 값은 도움이 되지 못 합니니다. 따라서 <strong>str</strong> 메소드를 추가하여 레코드의 분별할 수 있는 도움을 줄 수 있습니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># polls/models.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>question_text

<span class="token keyword">class</span> <span class="token class-name">Choice</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>choice_text
</code></pre></div><p><strong>str</strong> 은 interactive 프롬프트 컨벤션만을 위한 것이 아닌 어드민, REST API 에 자동으로 생성되는 결과이기도 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code>Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> What's new?<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre></div><p>추가로 사용자으 메소드를 추가합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> datetime

<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils <span class="token keyword">import</span> timezone


<span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    <span class="token keyword">def</span> <span class="token function">was_published_recently</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>pub_date <span class="token operator">&gt;=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>코드의 변경이 생겼고 관련 모듈을 사용해야 한다면 shell 을 다시 실행해야 합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> polls<span class="token punctuation">.</span>models <span class="token keyword">import</span> Choice<span class="token punctuation">,</span> Question

<span class="token comment"># __str__() 이 잘 작동하는 지 확인합니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> What's up?<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

<span class="token comment"># Django 는 keyword arguments를 통해서 데이터베이스 lookup API 사용할 수 있는 방법을 제공합니다. </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> What's up?<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>question_text__startswith<span class="token operator">=</span><span class="token string">'What'</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> What's up?<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

<span class="token comment"># 올해 작성된 question 을 가져옵니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>utils <span class="token keyword">import</span> timezone
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> current_year <span class="token operator">=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>year
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pub_date__year<span class="token operator">=</span>current_year<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> What's up?<span class="token operator">&gt;</span>

<span class="token comment"># 생성되지 않은 ID를 통해 question을 가져오려고 하면 exception이 발생합니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
DoesNotExist<span class="token punctuation">:</span> Question matching query does <span class="token keyword">not</span> exist<span class="token punctuation">.</span>

<span class="token comment"># primary key 로 Lookup 하는 것은 매우 일반적인 사용입니다. id=1 과 pk=1 은 같다고 볼 수 있습니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> What's up?<span class="token operator">&gt;</span>

<span class="token comment"># 사용자 메소드가 작동하는지 확인합니다. </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>was_published_recently<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>

<span class="token comment"># question 은 여러 쌍의 choice을 가지 수 있습니다. create 메소드는 새로운 choice 객체를 생성하여 추가합니다.  </span>
<span class="token comment"># relatedobject_set 을 forein key가 작성된 관련 object 를 의미합니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 아직 choice 가 작성되지 않은 것을 확인합니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

<span class="token comment"># choice 세 개를 생성합니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span>create<span class="token punctuation">(</span>choice_text<span class="token operator">=</span><span class="token string">'Not much'</span><span class="token punctuation">,</span> votes<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> Not much<span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span>create<span class="token punctuation">(</span>choice_text<span class="token operator">=</span><span class="token string">'The sky'</span><span class="token punctuation">,</span> votes<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> The sky<span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c <span class="token operator">=</span> q<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span>create<span class="token punctuation">(</span>choice_text<span class="token operator">=</span><span class="token string">'Just hacking again'</span><span class="token punctuation">,</span> votes<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Choice object에도 관련된 Question object 에 접근하는 API 가 있습니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>question
<span class="token operator">&lt;</span>Question<span class="token punctuation">:</span> What's up?<span class="token operator">&gt;</span>

<span class="token comment"># 그 반대도 역시, Question object는 Choice object에 접근할 수 있습니다.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> Not much<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> The sky<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> Just hacking again<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">3</span>

<span class="token comment"># The API automatically follows relationships as far as you need.</span>
<span class="token comment"># Use double underscores to separate relationships.</span>
<span class="token comment"># This works as many levels deep as you want; there's no limit.</span>
<span class="token comment"># Find all Choices for any question whose pub_date is in this year</span>
<span class="token comment"># (reusing the 'current_year' variable we created above).</span>

<span class="token comment"># API 를 사용하여 필요한 만큼 자동으로 relationship을 따라 가면 filtering 할 수 있습니다. </span>
<span class="token comment"># double underscore 는 relationship을 분리합니다. </span>
<span class="token comment"># </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Choice<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>question__pub_date__year<span class="token operator">=</span>current_year<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> Not much<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> The sky<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Choice<span class="token punctuation">:</span> Just hacking again<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>

<span class="token comment"># 다음은 choice 중에 하나를 삭제하는 방식입니다. </span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c <span class="token operator">=</span> q<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>choice_text__startswith<span class="token operator">=</span><span class="token string">'Just hacking'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="django-admin"><a href="#django-admin" class="header-anchor">#</a> Django Admin</h2> <h3 id="새로운-admin-사용자-생성"><a href="#새로운-admin-사용자-생성" class="header-anchor">#</a> 새로운 Admin 사용자 생성</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>python manage.py createsuperuser

<span class="token comment">#Enter your desired username and press enter.</span>
Username: admin

<span class="token comment">#You will then be prompted for your desired email address:</span>
Email address: admin@example.com

<span class="token comment"># The final step is to enter your password. You will be asked to enter your password twice, the second time as a confirmation of the first.</span>
Password: **********
Password <span class="token punctuation">(</span>again<span class="token punctuation">)</span>: *********
Superuser created successfully.
</code></pre></div><h3 id="admin에서-poll-app-데이터-수정하기"><a href="#admin에서-poll-app-데이터-수정하기" class="header-anchor">#</a> Admin에서 poll App 데이터 수정하기</h3> <p>아직 어드민 화면에서 polls App을 볼 수 는 없습니다. App 폴더의 admin.py 에 다음과 같이 코드를 추가합니다.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># polls/admin.py</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question

admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">)</span>
</code></pre></div><p>이제 아래와 같이 polls 가 추가된 것을 볼 수 있습니다.
</p><figure><img src="/admin03t.png"></figure><p></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frameworks/django/first-app-1.html" class="prev">
        First App - 1.Requests and responses
      </a></span> <span class="next"><a href="/frameworks/django/model.html">
        Model 1
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.46a52470.js" defer></script><script src="/assets/js/2.73abacf5.js" defer></script><script src="/assets/js/18.7d163443.js" defer></script>
  </body>
</html>
