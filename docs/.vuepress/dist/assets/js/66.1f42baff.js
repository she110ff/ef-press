(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{423:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"기초-인증과-권한"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#기초-인증과-권한"}},[t._v("#")]),t._v(" 기초-인증과 권한")]),t._v(" "),a("p",[t._v("현재 API에는 코드 스니펫을 편집하거나 삭제할 수있는 사람에 대한 제한이 없습니다. 다음과 같이 작동하기 원합니다.")]),t._v(" "),a("ul",[a("li",[t._v("코드 스니펫은 항상 제작자와 연결되어 있습니다.")]),t._v(" "),a("li",[t._v("인증된 사용자만 스니펫을 만들 수 있습니다.")]),t._v(" "),a("li",[t._v("스니펫을 만든 사람만 업데이트 하거나 삭제할 수 있습니다.")]),t._v(" "),a("li",[t._v("인증되지 않은 요청에 전체 읽기 전용 권한이 있어야 합니다.")])]),t._v(" "),a("h2",{attrs:{id:"모델에-정보-추가"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#모델에-정보-추가"}},[t._v("#")]),t._v(" 모델에 정보 추가")]),t._v(" "),a("p",[t._v("Snippet 모델 클래스에 필드를 추가하겠습니다. 이러한 필드 중 하나는 코드 스니펫을 만든 사용자를 나타내는 데 사용됩니다. 다른 필드는 highlight 코드의 HTML 표현을 저장하는 데 사용됩니다.")]),t._v(" "),a("p",[a("code",[t._v("models.py")]),t._v("의 Snippet 모델에 다음 두 필드를 추가하십시오.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("owner "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ForeignKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'auth.User'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" related_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'snippets'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" on_delete"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("models"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CASCADE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nhighlighted "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TextField"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("또한 모델이 저장 될 때 pygments 코드 highlight 라이브러리를 사용하여 강조 표시된 필드를 채우도록 해야합니다.:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pygments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lexers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" get_lexer_by_name\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pygments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("formatters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" HtmlFormatter\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pygments "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" highlight\n")])])]),a("p",[t._v("이제 모델 클래스에 "),a("code",[t._v(".save()")]),t._v("메소드를 추가합니다 :")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    Use the `pygments` library to create a highlighted HTML\n    representation of the code snippet.\n    """')]),t._v("\n    lexer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_lexer_by_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("language"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    linenos "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'table'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("linenos "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("\n    options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'title'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("title "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    formatter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" HtmlFormatter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" linenos"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("linenos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                              full"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("highlighted "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" highlight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lexer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" formatter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Snippet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Model이 변경되면 데이터베이스 테이블을 업데이트 해야합니다. 일반적으로 이를 수행하기 위해 데이터베이스 마이그레이션을 작성하지만 이 학습서의 목적을 위해 데이터베이스를 삭제하고 다시 시작하겠습니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("rm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sqlite3\nrm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r snippets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("migrations\npython manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py makemigrations snippets\npython manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py migrate\n")])])]),a("p",[a("code",[t._v("createsuperuser")]),t._v(" 명령을 사용하여 API 테스트에 사용할 다른 사용자를 빠르게 만들 수도 있습니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("python manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py createsuperuser\n")])])]),a("h2",{attrs:{id:"사용자-모델에-대한-엔드-포인트-추가"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#사용자-모델에-대한-엔드-포인트-추가"}},[t._v("#")]),t._v(" 사용자 모델에 대한 엔드 포인트 추가")]),t._v(" "),a("p",[t._v("사용자 API에 추가 하겠습니다. 다음과 같이 "),a("code",[t._v("serializers.py")]),t._v(" 에 새로운 UserSerializer 를 추가합니다. :")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contrib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" User\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserSerializer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelSerializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    snippets "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PrimaryKeyRelatedField"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("many"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queryset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Snippet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" User\n        fields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'snippets'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("사용자 모델에서 'snippets'의 relationship 은 역순이므로 ModelSerializer 클래스를 사용할 때는 기본적으로 포함되지 않기 때문에 명시적으로 필드를 추가했습니다.")]),t._v(" "),a("p",[t._v("views.py 에 몇 가지 view를 추가 할 것 입니다. user의 표현을 위해서는 읽기 전용에 제네릭 클래스 기반의 ListAPIView 및 RetrieveAPIView  뷰를 만듭니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contrib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("auth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" User\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ListAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UserSerializer\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserDetail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("generics"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RetrieveAPIView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    queryset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    serializer_class "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" UserSerializer\n")])])]),a("p",[t._v("UserSerializer 클래스도 import 합니다")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" snippets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serializers "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UserSerializer\n")])])]),a("p",[t._v("마지막으로 URL conf 에서 참조하기 위해 해당 뷰를 API에 추가 해야합니다. snippets/urls.py 의 패턴에 다음을 추가 하겠습니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" views"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\npath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'users/<int:pk>/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" views"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserDetail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("h2",{attrs:{id:"스니펫을-사용자에-연결"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#스니펫을-사용자에-연결"}},[t._v("#")]),t._v(" 스니펫을 사용자에 연결")]),t._v(" "),a("p",[t._v("지금 코드 스니펫을 만드는 경우 스니펫을 만든 사용자를 스니펫 인스턴스와 연결할 방법이 없습니다. 사용자는 직렬화된 표현의 일부로 전송되지 않지만 들어오는 request의 속성이기는 합니다.")]),t._v(" "),a("p",[t._v(".perform_create() 메소드는 오버라이딩하여 스니펫 view에서 인스턴스가 저장되는 관리 방식을 수정하여 들어오는 요청(request) 또는 요청 된 URL에 포함된 정보를 처리할 수 ​​있도록 하는 것입니다.")]),t._v(" "),a("p",[t._v("SnippetList 뷰 클래스에 다음과 같은 메소드를 추가합니다.:")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("perform_create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    serializer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("save"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("owner"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("serializer의 create() 메소드는 이제 request의 검증된 데이터(validated_date)와 함께 'owner' 추가 필드를 전달 받습니다.")]),t._v(" "),a("h2",{attrs:{id:"serializer의-업데이트"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#serializer의-업데이트"}},[t._v("#")]),t._v(" serializer의 업데이트")]),t._v(" "),a("p",[t._v("스니펫이 생성한 사용자와 연결되었으므로 이를 SnippetSerializer 반영하도록 수정 하겠습니다. 다음 필드를 serializer 정의에 추가 하겠습니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("owner "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ReadOnlyField"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'owner.username'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("참고 : 'owner'를 내부 Meta클래스의 필드 목록에도 추가 해야합니다 .")]),t._v(" "),a("p",[t._v("source는 속성 필드를 채우는 데 사용되며, 직렬화 된 인스턴스의 모든 속성에 가리킬 수 있습니다. 위에 표시된 점 표기법을 사용할 수도 있습니다.")]),t._v(" "),a("p",[t._v("위에서 추가한 필드 ReadOnlyField 는 CharField, BooleanField 달리, 클래스 유형이 지정되지 않습니다. ReadOnlyField 는 항상 읽기 전용으로 직렬화 표현을 위해 사용되며 모델을 업데이트 하기 위해 사용되지 않습니다.")]),t._v(" "),a("h2",{attrs:{id:"뷰에-필요한-권한-추가"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#뷰에-필요한-권한-추가"}},[t._v("#")]),t._v(" 뷰에 필요한 권한 추가")]),t._v(" "),a("p",[t._v("이제 코드 스니펫이 사용자와 연결 되었으므로 인증된 사용자만 코드 스 니펫을 작성, 업데이트 및 삭제할 수 있도록 해야합니다.")]),t._v(" "),a("p",[t._v("REST 프레임워크에는 지정된 뷰에 액세스 할 수있는 사람을 제한하는 데 사용할 수있는 여러 권한 클래스가 포함되어 있습니다. 이 경우 IsAuthenticatedOrReadOnly 은 인증된 요청에서 읽기-쓰기 액세스를 하고 인증되지 않은 요청은 읽기 전용 액세스를 갖도록 하는 것입니다.")]),t._v(" "),a("p",[t._v("먼저 views 모듈에 다음을 import를 추가하십시오.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" permissions\n")])])]),a("p",[t._v("SnippetList 와 SnippetDetail 뷰 클래스 모두에 다음을 추가합니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("permission_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("permissions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IsAuthenticatedOrReadOnly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h2",{attrs:{id:"browsable-api에-로그인-추가"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#browsable-api에-로그인-추가"}},[t._v("#")]),t._v(" browsable API에 로그인 추가")]),t._v(" "),a("p",[t._v("브라우저를 열고 현재 browsable API로 이동하면 더 이상 새 코드 스니펫을 만들 수 없습니다. 그렇게 하려면 사용자로 로그인 할 수 있어야 합니다.")]),t._v(" "),a("p",[t._v("프로젝트 수준 "),a("code",[t._v("urls.py")]),t._v("파일에서 URLconf를 편집하여 browsable API와 함께 사용할 로그인 view를 추가할 수 있습니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urls "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" include\n")])])]),a("p",[t._v("또한 파일 끝에 browsable API에 대한 로그인 및 로그 아웃을 포함할 패턴을 추가하십시오.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("urlpatterns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'api-auth/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" include"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.urls'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("이제 브라우저를 다시 열고 페이지를 새로 고치면 페이지 오른쪽 상단에 '로그인' 링크가 표시됩니다. 앞에서 만든 사용자 중 하나로 로그인하면 코드 스니펫을 다시 만들 수 있습니다.")]),t._v(" "),a("p",[t._v("코드 스니펫을 몇 개 만든 후에는 '/ users /'엔드 포인트로 이동 한 다음 각 사용자의 '스니펫'필드에서 각 사용자와 관련된 스니펫 ID 목록이 표시에 있는지 확인하십시오.")]),t._v(" "),a("h2",{attrs:{id:"객체-수준-권한"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#객체-수준-권한"}},[t._v("#")]),t._v(" 객체 수준 권한")]),t._v(" "),a("p",[t._v("실제로 모든 코드 스니펫을 누구나 볼 수 있기를 원하지만 코드 스니펫을 만든 사용자만 해당 코드 스니펫을 업데이트하거나 삭제할 수 있어야 합니다.")]),t._v(" "),a("p",[t._v("그러기 위해서는 사용자 지정 권한을 만들어야 합니다.")]),t._v(" "),a("p",[t._v("스니펫 앱에서 permissions.py 파일을 만들고")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" permissions\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IsOwnerOrReadOnly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("permissions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BasePermission"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    Custom permission to only allow owners of an object to edit it.\n    """')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("has_object_permission")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Read permissions are allowed to any request,")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# so we'll always allow GET, HEAD or OPTIONS requests.")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" permissions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SAFE_METHODS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Write permissions are only allowed to the owner of the snippet.")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("owner "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n")])])]),a("p",[t._v("이제 SnippetDetail 뷰 클래스에서 permission_classes 속성을 편집하여 스니펫 인스턴스의 엔드 포인트에 해당 사용자 지정 권한을 추가 할 수 있습니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("permission_classes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("permissions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IsAuthenticatedOrReadOnly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                      IsOwnerOrReadOnly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" snippets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("permissions "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" IsOwnerOrReadOnly\n")])])]),a("p",[t._v("이제 브라우저를 다시 열면 코드 스니펫을 작성한 동일한 사용자로 로그인 한 경우 'DELETE'및 'PUT'조치가 스니펫 인스턴스 엔드 포인트에만 나타납니다.")]),t._v(" "),a("h2",{attrs:{id:"api로-인증"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api로-인증"}},[t._v("#")]),t._v(" API로 인증")]),t._v(" "),a("p",[t._v("이제 API에 대한 권한 세트가 있으므로 스니펫을 수정하려면 요청을 인증해야 합니다. 인증 클래스를 설정하지 않았으므로 현재 기본값이 적용됩니다. SessionAuthentication 및 BasicAuthentication.")]),t._v(" "),a("p",[t._v("웹 브라우저를 통해 API와 상호 작용할 때 로그인 할 수 있으며 브라우저 세션은 요청에 필요한 인증을 제공합니다.")]),t._v(" "),a("p",[t._v("프로그래밍 방식으로 API와 상호 작용하는 경우 각 요청에 대해 인증 자격 증명을 명시적으로 제공해야합니다.")]),t._v(" "),a("p",[t._v("인증하지 않고 스니펫을 만들려고 하면 오류가 발생합니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("http POST http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("snippets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"print(123)"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"detail"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Authentication credentials were not provided."')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("앞서 만든 사용자 중 하나의 사용자 이름과 비밀번호를 포함시켜 요청을 성공적으로 수행 할 수 있습니다.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("password123 POST http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("snippets"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"print(789)"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"owner"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"title"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"print(789)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"linenos"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" false"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"language"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"python"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"style"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"friendly"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("이제 웹 API 및 시스템 사용자 및 생성 한 코드 스 니펫에 대한 상당히 세분화 된 권한 세트를 갖습니다.")])])}),[],!1,null,null,null);s.default=e.exports}}]);